# [有限温度有限密度场论中的单圈积分B0（two-line integral）] - 实现文档

## 1. 公式标识
- **程序实现**: `B0`
- **对应文件**: `../../src/relaxtime/OneLoopIntegrals.jl`


## 2. 物理意义

### 热场论的推广

这里的 $B_0$ 函数是标准零温 Passarino-Veltman 函数在**有限温度和有限密度场论**中的自然推广，主要体现在以下几个关键特征：

- **有限温度处理 ($\beta$)**: 通过**松原频率 (Matsubara frequency)** $i\omega_n$ 和相应的求和 $\sum_n$ 来实现。在零温极限下（$\beta \to \infty$），这个离散的频率求和会收敛回对能量分量 $k^0$ 的连续积分，恢复到传统的零温场论形式。

- **有限密度效应 ($\mu_i$)**: 在传播子中明确引入了化学势 $\mu$，表现为 $i\omega_n + \mu$ 的形式。这对于描述具有净粒子数的系统（如夸克胶子等离子体、致密星体物质等）至关重要，因为化学势反映了系统的费米子数密度。

- **正规化需求 ($\Lambda$)**: 与零温情况类似，这些积分仍然需要适当的正规化方案来处理可能出现的发散，$\Lambda$ 参数可能代表某种截断标度。

### 物理图像

在有限温度场论的框架下，$B_0$ 函数具有清晰的物理图像：

- **探针传播**: 该函数描述的是一个具有（松原）能量 $i\nu_m$ 和动量 $\vec{k}$ 的外部"探针"（如光子、胶子或轴子）在热介质中的传播行为。

- **虚粒子对产生**: 这个探针在有限温度的热浴中能够劈裂成一个虚的粒子-反粒子对，对应的粒子具有质量 $m_1, m_2$ 和化学势 $\mu_1, \mu_2$。

- **介质响应**: 整个过程反映了热介质对外部扰动的动力学响应，是计算**有限温度极化函数**（如光子自能、介子传播子修正等）的核心构成要素。

- **统计效应**: 通过松原频率求和，该函数自然地包含了量子统计效应（费米-狄拉克或玻色-爱因斯坦统计），描述了热激发粒子对圈图过程的贡献。

这种推广使得 $B_0$ 能够准确地描述从相对论重离子碰撞到早期宇宙演化、从致密星体物理到凝聚态系统中各种有限温度有限密度的量子场论过程。

### 核心命名逻辑：根据积分中传播子（分母）的数量

这个命名系统源于对**单圈图（One-Loop Diagrams）** 的标准化处理，通常被称为 **Passarino-Veltman 约化** 方法。在这个体系下：

1.  **A - 单点函数**
    *   它是最基本的积分，只包含**一个**传播子（分母）。
    *   在费曼图中，它通常对应一个**蝌蚪图**。
    *   因为它是最简单的，所以用第一个字母 **A** 来命名。

2.  **B - 两点函数**
    *   它包含**两个**传播子（分母）。
    *   在费曼图中，它对应一个**泡泡图**。这正是你之前问的“Bubble函数”在这个领域最标准的体现！
    *   用第二个字母 **B** 来命名。

3.  **C - 三点函数**
    *   它包含**三个**传播子（分母）。
    *   在费曼图中，它对应一个**三角图**。
    *   用第三个字母 **C** 来命名。

以此类推，还会有 **D函数**（四点函数，箱型图）和 **E函数**（五点函数）等。

### 下标 “₀” 的含义

下标 **₀**（在 B₀ 和 C₀ 中）通常表示这是该函数最**标量**的、最**基础**的形式。它意味着：
*   这些积分函数是在忽略外部粒子动量张量结构的情况下定义的（即，已经从分子中提取出了所有可能的张量结构后，剩下的标量积分核）。
*   在计算更复杂的振幅时，最终都会约化到计算这些基础的标量积分 A, B₀, C₀, D₀ 等。

## 3. 数学表达式
### 3.1 原始公式
```math
B_0(k, m_1, \mu_1, m_2, \mu_2, i\nu_m, \beta, \Lambda) = \frac{16\pi^2}{\beta} \sum_n \exp(i\omega_n \eta) \int \frac{d^3p}{(2\pi)^3} \frac{1}{((i\omega_n + \mu_1)^2 - E_1^2)} \frac{1}{((i\omega_n - i\nu_m + \mu_2)^2 - E_2^2)}
```

### 3.2 数学处理后的形式
```math
B_0(k, m_1, \mu_1, m_2, \mu_2, i\nu_m, \beta, \Lambda) = \tilde{B}_0^+(-\lambda, k, m_1, m_2, \mu_1, \beta, \Lambda) - \tilde{B}_0^-(\lambda, k, m_1, m_2, \mu_1, \beta, \Lambda) + \tilde{B}_0^+(\lambda, k, m_2, m_1, \mu_2, \beta, \Lambda) - \tilde{B}_0^-(-\lambda, k, m_2, m_1, \mu_2, \beta, \Lambda)
```
其中
```math
\tilde{B}_0^\pm(\lambda, k, m, m', \mu, \beta, \Lambda) = 2 \int_{m}^{\Lambda_E} dE \, pf(\pm E - \mu) \int_{-1}^{+1} dx \frac{1}{\lambda^2 + 2\lambda E + 2pkx - k^2 + m^2 - m'^2}
```
m和m'分别表示**两个不同费米子传播线的质量**
PNJL模型中，将**夸克有效分布函数**修正后可以表示为：
```math
\tilde{B}_0^{\pm}(\lambda, k, m_1, m_2, \mu_1, \mu_2, T, \varphi) = 2 \int_{m_1}^{\sqrt{m_1^2 + \lambda^2}} p \, n^\pm (E, \mu)\int_{-1}^{+1}  \frac{1}{\lambda^2 + 2 \lambda E + 2pk x - k^2 + m_1^2 - m_2^2} d x d E
```
其中k是外部动量
```math
\lambda = p_0 + \mu_1 - \mu_2
```
```math
E = \sqrt{k^2 + m_1^2}
```
### 3.3 算法处理后最终形式
#### k=0时：

##### 实部：
\[
\text{Re} \hat{B}_0^\pm = 4 \, \mathcal{P} \int_{m}^{\Lambda_E} dE \, \frac{p \, f(\pm E - \mu)}{\lambda^2 + 2\lambda E + m^2 - m'^2}
\]
其中 \(\mathcal{P}\) 表示柯西主值积分，\(p = \sqrt{E^2 - m^2}\) 是内部动量(圈动量)。

##### 虚部：
\[
\text{Im} \hat{B}_0^\pm = \frac{2\pi}{\lambda} \, p_0 \, f(\pm E_0 - \mu) \, \Theta(\Lambda_E - E_0) \, \Theta(E_0 - m)
\]
其中：
- \(E_0 = -\frac{\lambda^2 + m^2 - m'^2}{2\lambda}\) 是积分分母的极点，
- \(p_0 = \sqrt{E_0^2 - m^2}\) 是 \(E_0\) 对应的动量，
- \(\Theta\) 是赫维赛德阶跃函数，确保 \(E_0\) 在积分区间 \([m, \Lambda_E]\) 内。

#### k>0时：
##### 实部：
\[
\text{Re} \tilde{B}_0^\pm = \frac{1}{k} \int_{m}^{\Lambda_E} dE \, f(\pm E - \mu) \, \log \left| \frac{(\lambda + E)^2 - (p - k)^2 - m'^2}{(\lambda + E)^2 - (p + k)^2 - m'^2} \right|
\]
其中：
- \( p = \sqrt{E^2 - m^2} \) 是内部动量，
- \( \lambda \) 是相关参数（通常与 \( k_0 \) (传播子的能量分量(时间分量))相关），
- \( k \) 可以理解为传播子的(三)动量大小
- 传播子不需要满足在壳条件 \(k_0^2 = k^2 + m^2\)，另外，单线和双线费米子圈积分A和B0是发散的，因此需要引入能量截断 \(\Lambda_E\) 进行正规化(但C是收敛的)
- \( m \) 和 \( m' \) 是质量参数，
- \( \mu \) 是化学势，
- \( \Lambda_E \) 是能量截断，
- \( f(\pm E - \mu) \) 是费米-狄拉克分布函数或其他相关函数。

##### 虚部：
虚部有两种等效表示形式。第一种使用明确的积分限 \( E_1 \) 和 \( E_2 \)，便于数值计算；第二种使用赫维赛德阶跃函数（Θ 函数），直接反映条件。
这里虚部需要积分的原因是当E处于积分限中时,对原始积分的内层积分变量dx在其积分限中会存在奇点

###### 表示一（使用积分限 \( E_1 \) 和 \( E_2 \))：
\[
\text{Im} \tilde{B}_0^\pm = \frac{\pi \, \mathrm{sgn}(\lambda)}{k} \int_{E_{\text{min}}}^{E_{\text{max}}} dE \, f(\pm E - \mu)
\]
其中：
- \( E_{\text{min}} \) 和 \( E_{\text{max}} \) 是调整后的积分限，由以下步骤确定：
  1. 计算 \( E_1 \) 和 \( E_2 \)（来自 temp.pdf 公式 (4.20)）：
     \[
     E_{1,2} = \frac{\lambda(\lambda^2 - k^2 + m^2 - m'^2)}{2(k^2 - \lambda^2)} \pm k \frac{\sqrt{(\lambda^2 - k^2 + m^2 - m'^2)^2 - 4m^2(k^2 - \lambda^2)}}{2(k^2 - \lambda^2)}
     \]
     这里假设 \( E_1 \leq E_2 \)。
  2. 设置积分限：
     \[
     E_{\text{min}} = \max(m, E_1), \quad E_{\text{max}} = \min(\Lambda_E, E_2)
     \]
  3. 如果 \( E_{\text{min}} > E_{\text{max}} \)，则虚部为零。

###### 表示二（使用赫维赛德阶跃函数）：
\[
\text{Im} \tilde{B}_0^\pm = \frac{\pi \, \mathrm{sgn}(\lambda)}{k} \int_{m}^{\Lambda_E} dE \, \Theta\left(2pk - \left| \lambda^2 + 2\lambda E - k^2 + m^2 - m'^2 \right| \right) f(\pm E - \mu)
\]
其中：
- \( \Theta \) 是赫维赛德阶跃函数，确保积分仅在条件 \( 2pk \geq \left| \lambda^2 + 2\lambda E - k^2 + m^2 - m'^2 \right| \) 满足时贡献。
- 其他参数与实部相同。

#### 说明：
- 这些表达式适用于 \( k > 0 \) 的情况。当 \( k = 0 \) 时，需要使用不同的形式（如 image.png 中 \( k=0 \) 的公式）。
- 积分限 \( E_1 \) 和 \( E_2 \) 对应于 temp.pdf 中公式 (4.19) 的解，定义了虚部存在的能量区间。根据 temp.pdf 的讨论，有三种情况：
  - 无解或解都在区间 \([m, \Lambda_E]\) 外：虚部为零。
  - 一个解在区间内，另一个在外：虚部积分从该解到 \(\Lambda_E\)（如果 \( E_1 \) 在内）或从 \( m \) 到该解（如果 \( E_2 \) 在内），但通常调整后积分限为 \( [E_{\text{min}}, E_{\text{max}}] \)。
  - 两个解都在区间内：虚部积分从 \( E_1 \) 到 \( E_2 \)。
- 在数值计算中，表示一更常用，因为它直接提供了积分区间。



## 4. 参数说明表

| 参数 | 符号 | 类型 | 单位 | 物理意义 | 取值范围 |
|------|------|------|------|----------|----------|
| λ | λ | 输入 | fm⁻¹ | 能量-化学势组合参数 | [-20, 20] fm⁻¹ |
| k_norm | \|k\| | 输入 | fm⁻¹ | 介子动量模 | [0, 10] fm⁻¹ |
| m1 | m₁ | 输入 | fm⁻¹ | 第一种夸克质量 | [0.005, 2.5] fm⁻¹ |
| μ1 | μ₁ | 输入 | fm⁻¹ | 第一种夸克化学势 | [-5, 5] fm⁻¹ |
| m2 | m₂ | 输入 | fm⁻¹ | 第二种夸克质量 | [0.005, 2.5] fm⁻¹ |
| μ2 | μ₂ | 输入 | fm⁻¹ | 第二种夸克化学势 | [-5, 5] fm⁻¹ |
| T | T | 输入 | fm⁻¹ | 温度 | [0.005, 2.0] fm⁻¹ |
| sign | ± | 输入 | 无量纲 | 分布函数符号选择 | ±1 |
| B̃₀ | B̃₀ | 输出 | 无量纲 | 极化函数核分量 | 复数 |


## 5. 输入参数详细说明
### 5.1 必需参数
- **k_norm**: 介子的三维动量大小，决定介子在介质中的运动状态，典型值范围50-500 MeV
- **m1, m2**: 参与极化的两种夸克的质量，来自能隙方程求解，u/d夸克典型值5-300 MeV，s夸克典型值100-500 MeV
- **μ1, μ2**: 对应夸克的化学势，在有限密度情况下重要，典型值0-800 MeV
- **k0**: 介子的零动量分量能量，与介子质量相关，典型值100-1000 MeV
- **T**: 系统温度，影响分布函数，典型值100-250 MeV

### 5.2 可选参数
- **β**: 逆温度，默认值为1/T，影响分布函数的指数衰减
- **φ**: Polyakov圈参数，在PNJL模型中考虑禁闭效应，默认值0（高温解禁闭相）
- **method**: 积分方法选择，默认`:cauchy_principal`处理极点

## 6. 输出结果说明
### 6.1 主输出
- **B0**: 复数类型的极化函数分量，实部反映介子的能谱移动，虚部反映衰变宽度，单位MeV²


## 7. 依赖关系
### 7.1 输入依赖
- **夸克质量模块**: 提供温度/化学势依赖的夸克质量m1, m2
- **分布函数模块**: 提供费米-狄拉克分布n^±(E∓μ)的计算
- **数值积分库**: 提供自适应积分和柯西主值积分算法

### 7.2 输出用途
- **极化函数计算**: 被`polarization`函数调用，用于计算介子极化张量