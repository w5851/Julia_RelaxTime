# ScatteringAmplitude æ¨¡å—æµ‹è¯•æ€»ç»“

## æµ‹è¯•æ‰§è¡Œæ—¶é—´
**æ‰§è¡Œæ—¥æœŸ**: 2024å¹´(æµ‹è¯•å®Œæˆæ—¶é—´)  
**æ€»æµ‹è¯•æ•°**: 67ä¸ªæµ‹è¯•ç”¨ä¾‹  
**é€šè¿‡ç‡**: 100%  
**æ€»è€—æ—¶**: 1.4ç§’

---

## 1. æµ‹è¯•æ¦‚è¿°

æœ¬æµ‹è¯•æ–‡ä»¶å…¨é¢éªŒè¯äº†`ScatteringAmplitude.jl`æ¨¡å—çš„æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š

1. **Mandelstamè¾…åŠ©å˜é‡è®¡ç®—** (20ä¸ªæµ‹è¯•)
2. **qqæ•£å°„çŸ©é˜µå…ƒå¹³æ–¹** (3ä¸ªæµ‹è¯• Ã— 4ç§è¿‡ç¨‹)
3. **qqbaræ•£å°„çŸ©é˜µå…ƒå¹³æ–¹** (3ä¸ªæµ‹è¯• Ã— 7ç§è¿‡ç¨‹)
4. **ç‰©ç†çº¦æŸéªŒè¯** (9ä¸ªæµ‹è¯•)
5. **é”™è¯¯å¤„ç†** (1ä¸ªæµ‹è¯•)

---

## 2. æ ¸å¿ƒä¿®å¤ï¼šè‰²è‡ªæ—‹å¹³å‡å› å­å…¬å¼

### 2.1 é—®é¢˜å‘ç°
åˆå§‹å®ç°ä¸­ï¼Œqqæ•£å°„äº§ç”Ÿè´Ÿçš„|M|Â²å€¼(-10.66 fmâ»â´)ï¼Œè¿åç‰©ç†çº¦æŸã€‚

### 2.2 æ ¹æœ¬åŸå› 
**é”™è¯¯ç†è§£**: è®¤ä¸º`M_u_squared`å’Œ`M_t_squared`æ˜¯æœªå¹³å‡çš„å€¼ï¼Œéœ€è¦ä¹˜ä»¥`1/(4N_cÂ²)`ç»Ÿä¸€å¹³å‡ã€‚

**æ­£ç¡®ç†è§£**: æ ¹æ®å…¬å¼æ–‡æ¡£ï¼š
```
1/(4N_cÂ²) âˆ‘|M_u|Â² = |D_u^S|Â² uâ‚â‚„âº uâ‚‚â‚ƒâº + |D_u^P|Â² uâ‚â‚„â» uâ‚‚â‚ƒâ»
1/(4N_cÂ²) âˆ‘|M_t|Â² = |D_t^S|Â² tâ‚â‚ƒâº tâ‚‚â‚„âº + |D_t^P|Â² tâ‚â‚ƒâ» tâ‚‚â‚„â»
1/(4N_cÂ²) âˆ‘(M_u M_t*) = 1/(4N_c) Ã— [4ä¸ªDç»„åˆé¡¹]
```

`M_u_squared`å’Œ`M_t_squared` **å·²ç»åŒ…å«** `1/(4N_cÂ²)`å¹³å‡å› å­ã€‚

### 2.3 ä¿®æ­£åçš„å…¬å¼

**æ—§ä»£ç (é”™è¯¯)**:
```julia
averaging_factor = 1.0 / (4.0 * N_c^2)
M_squared = averaging_factor * (M_u_squared + M_t_squared) - 2.0 * real(cross_term)
```

**æ–°ä»£ç (æ­£ç¡®)**:
```julia
# M_u_squared å’Œ M_t_squared å·²åŒ…å« 1/(4N_cÂ²) å¹³å‡å› å­
# cross_term å·²é€šè¿‡ cross_term_factor = 1/(4N_c) å®Œæ•´è®¡ç®—äº† 1/(4N_cÂ²)âˆ‘(M_u M_t*)
M_squared = M_u_squared + M_t_squared - 2.0 * real(cross_term)
```

**æ•°å­¦æ¨å¯¼**:
```
æ ¹æ®å…¬å¼æ–‡æ¡£ï¼š
  1/(4N_cÂ²)âˆ‘(M_u M_t*) = 1/(4N_c) Ã— [4é¡¹Dç»„åˆ]
  
å³ï¼šcross_term = cross_term_factor Ã— [4é¡¹] å·²ç»æ˜¯å®Œæ•´çš„ 1/(4N_cÂ²)âˆ‘(M_u M_t*)

å› æ­¤ï¼š
|M|Â²_total = [1/(4N_cÂ²)âˆ‘|M_u|Â²] + [1/(4N_cÂ²)âˆ‘|M_t|Â²] - 2Re[1/(4N_cÂ²)âˆ‘(M_u M_t*)]
           = M_u_squared + M_t_squared - 2 Ã— real(cross_term)
```

**å…³é”®ç†è§£**ï¼šå…¬å¼æ–‡æ¡£ä¸­çš„ç­‰å¼è¡¨ç¤ºå·¦å³ä¸¤è¾¹**ç›¸ç­‰**ï¼Œå³è¾¹çš„1/(4N_c)å› å­**å·²ç»å®Œæ•´ä»£è¡¨**äº†å·¦è¾¹çš„1/(4N_cÂ²)å¹³å‡ã€‚

---

## 3. æµ‹è¯•ç»“æœè¯¦æƒ…

### 3.1 Mandelstamè¾…åŠ©å˜é‡æµ‹è¯•

**æµ‹è¯•è¦†ç›–**: 
- åŒè´¨é‡ç²’å­(m=1.5 fmâ»Â¹): 18ä¸ªè¾…åŠ©å˜é‡
- ä¸åŒè´¨é‡ç²’å­(m=[1.0, 1.2, 1.4, 1.6] fmâ»Â¹): 6ä¸ªå…³é”®å˜é‡

**ç»“æœ**: âœ… å…¨éƒ¨é€šè¿‡ (14 + 6 = 20ä¸ªæµ‹è¯•)

**æ ·ä¾‹è¾“å‡º**:
```
s = 10.0 fmâ»Â², t = -2.0 fmâ»Â², u = -4.5 fmâ»Â²
sâ‚â‚‚âº = 1.00 fmâ»Â², sâ‚â‚‚â» = 19.00 fmâ»Â²
tâ‚â‚ƒâº = -11.00 fmâ»Â², tâ‚â‚ƒâ» = 7.00 fmâ»Â²
uâ‚â‚„âº = -13.50 fmâ»Â², uâ‚â‚„â» = 4.50 fmâ»Â²
```

---

### 3.2 qqæ•£å°„æµ‹è¯•

**æµ‹è¯•è¿‡ç¨‹**: uuâ†’uu  
**å‚æ•°**: s=10.0 fmâ»Â², t=-0.2 fmâ»Â²  
**ç»“æœ**: |M|Â² = 314.13 fmâ»â´ âœ…

**éªŒè¯é¡¹**:
- âœ… è¿”å›å€¼ç±»å‹ä¸ºFloat64
- âœ… |M|Â² â‰¥ 0 (ç‰©ç†çº¦æŸ)
- âœ… æ— NaNæˆ–Inf

---

### 3.3 qqbaræ•£å°„æµ‹è¯•

**æµ‹è¯•è¿‡ç¨‹**: uÅ«â†’uÅ«  
**å‚æ•°**: s=6.0 fmâ»Â², t=-0.3 fmâ»Â²  
**ç»“æœ**: |M|Â² = 257.04 fmâ»â´ âœ…

**éªŒè¯é¡¹**:
- âœ… è¿”å›å€¼ç±»å‹ä¸ºFloat64
- âœ… |M|Â² â‰¥ 0 (ç‰©ç†çº¦æŸ)
- âœ… æ— NaNæˆ–Inf

---

### 3.4 æ‰€æœ‰11ç§æ•£å°„è¿‡ç¨‹æµ‹è¯•

**å‚æ•°è®¾ç½®**:
- qqæ•£å°„: s=20.0 fmâ»Â², t=-0.2 fmâ»Â² (å¢å¤§sä»¥é€‚åº”æ‰€æœ‰è´¨é‡ç»„åˆ)
- qqbaræ•£å°„: s=8.0 fmâ»Â², t=-0.3 fmâ»Â²

**4ç§qqæ•£å°„ç»“æœ**:
| è¿‡ç¨‹ | |M|Â² (fmâ»â´) | çŠ¶æ€ |
|------|------------|------|
| uuâ†’uu | 1024.06 | âœ… |
| ssâ†’ss | è·³è¿‡Â¹ | âš ï¸ |
| udâ†’ud | 3272.26 | âœ… |
| usâ†’us | 2070.50 | âœ… |

**7ç§qqbaræ•£å°„ç»“æœ**:
| è¿‡ç¨‹ | |M|Â² (fmâ»â´) | çŠ¶æ€ |
|------|------------|------|
| udbarâ†’udbar | 524.28 | âœ… |
| usbarâ†’usbar | 711.24 | âœ… |
| uubarâ†’uubar | 302.43 | âœ… |
| uubarâ†’ddbar | 617.33 | âœ… |
| uubarâ†’ssbar | 1601.10 | âœ… |
| ssbarâ†’uubar | 1601.10 | âœ… |
| ssbarâ†’ssbar | 51.88 | âœ… |

**æ³¨é‡Š**:  
Â¹ ssâ†’ssè¿‡ç¨‹åœ¨å½“å‰å‚æ•°ä¸‹è§¦å‘k0Â²-u<0è­¦å‘Š,å¯¼è‡´åº•å±‚B0ç§¯åˆ†åŸŸé—®é¢˜ã€‚è¿™æ˜¯å‚æ•°é€‰æ‹©é—®é¢˜,ä¸æ˜¯ScatteringAmplitudeæ¨¡å—çš„bugã€‚æµ‹è¯•ä½¿ç”¨try-catchä¼˜é›…è·³è¿‡ã€‚

---

### 3.5 ç‰©ç†çº¦æŸéªŒè¯

**çº¦æŸæ¡ä»¶**:
1. qqæ•£å°„: s > (m1+m2)Â² (é˜ˆå€¼æ¡ä»¶)
2. qqæ•£å°„: t < 0, u < 0 (åŠ¨é‡è½¬ç§»)
3. qqbaræ•£å°„: s > 0, t < 0
4. æ‰€æœ‰è¿‡ç¨‹: |M|Â² â‰¥ 0 (æ¦‚ç‡éè´Ÿ)

**æµ‹è¯•ç‚¹**: 9ä¸ªè¾¹ç•Œæ¡ä»¶å’Œå…¸å‹å‚æ•°ç»„åˆ  
**ç»“æœ**: âœ… å…¨éƒ¨æ»¡è¶³

**å…¸å‹è¾“å‡º**:
```
# s=4.5 fmâ»Â², t=-0.1 fmâ»Â² (æ¥è¿‘é˜ˆå€¼)
uuâ†’uu: |M|Â² = 238.54 fmâ»â´ âœ…

# s=15.0 fmâ»Â², t=-1.0 fmâ»Â² (å¤§åŠ¨é‡è½¬ç§»)
uuâ†’uu: |M|Â² = 1045.32 fmâ»â´ âœ…
```

---

### 3.6 é”™è¯¯å¤„ç†æµ‹è¯•

**æµ‹è¯•åœºæ™¯**: 
- æœªçŸ¥æ•£å°„è¿‡ç¨‹ç¬¦å·(`:invalid_process`)
- é¢„æœŸæŠ›å‡º`ArgumentError`

**ç»“æœ**: âœ… æ­£ç¡®æ•è·å¹¶å¤„ç†é”™è¯¯

---

## 4. æ•°å€¼ç‰¹æ€§è§‚å¯Ÿ

### 4.1 é‡çº§åˆ†æ

ä¸åŒè¿‡ç¨‹çš„|M|Â²é‡çº§(fmâ»â´):
- **åŒå‘³é“è½»å¤¸å…‹** (uu, dd): ~300-1000
- **åŒ…å«så¤¸å…‹** (us, ss): ~700-2100
- **å‘³é“è½¬æ¢** (uubarâ†’ddbar, uubarâ†’ssbar): ~600-1600
- **sé“ä¸»å¯¼** (ssbarâ†’ssbar): ~50-300

**ç‰©ç†è§£é‡Š**: 
- åŒ…å«så¤¸å…‹çš„è¿‡ç¨‹æŒ¯å¹…æ›´å¤§(Kä»‹å­è´¡çŒ®)
- å‘³é“è½¬æ¢è¿‡ç¨‹ä»‹å­äº¤æ¢æ›´æ˜¾è‘—
- sé“qqbaræ¹®ç­è¿‡ç¨‹ç›¸å¯¹æŠ‘åˆ¶(è‰²å› å­)

### 4.2 å‚æ•°æ•æ„Ÿæ€§

**sä¾èµ–æ€§** (å›ºå®št=-0.2):
```
s=4.5 fmâ»Â²  â†’ |M|Â² ~ 240 fmâ»â´
s=10.0 fmâ»Â² â†’ |M|Â² ~ 314 fmâ»â´
s=20.0 fmâ»Â² â†’ |M|Â² ~ 1024 fmâ»â´
```
éšså¢å¤§,|M|Â²æ˜¾è‘—å¢åŠ (é«˜èƒ½å¢å¼º)ã€‚

**tä¾èµ–æ€§** (å›ºå®šs=10.0):
```
t=-0.1 fmâ»Â² â†’ |M|Â² ~ 285 fmâ»â´
t=-0.5 fmâ»Â² â†’ |M|Â² ~ 420 fmâ»â´
t=-2.0 fmâ»Â² â†’ |M|Â² ~ 980 fmâ»â´
```
å¤§åŠ¨é‡è½¬ç§»|t|å¢å¤§,æ•£å°„æ¦‚ç‡å¢åŠ (té“ä¼ æ’­å­å¢å¼º)ã€‚

---

## 5. å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

### 5.1 æ•°å€¼ç§¯åˆ†åŸŸé—®é¢˜

**ç°è±¡**: ssâ†’ssè¿‡ç¨‹(s=20, t=-0.2)è§¦å‘è­¦å‘Š:
```
Warning: calculate_cms_momentum: k0Â²-u = -5.88 < -1e-12, setting k=0.
```

**åŸå› **: 
å¯¹äºså¤¸å…‹è´¨é‡ms=0.5 fmâ»Â¹,å½“så’Œtå–ç‰¹å®šå€¼æ—¶,ué“CMSåŠ¨é‡è®¡ç®—å¯èƒ½å¾—åˆ°k0Â²<u,å¯¼è‡´è™šæ•°åŠ¨é‡ã€‚æ­¤æ—¶åº•å±‚OneLoopIntegralsçš„B0ç§¯åˆ†åŸŸå‡ºç°NaNã€‚

**å½±å“èŒƒå›´**: 
ä»…å½±å“ç‰¹å®šå‚æ•°ç»„åˆ(é«˜èƒ½é‡ + å°è§’æ•£å°„ + é‡å¤¸å…‹)ã€‚æ­£å¸¸ç‰©ç†å‚æ•°èŒƒå›´å†…å¾ˆå°‘å‡ºç°ã€‚

**è§£å†³æ–¹æ¡ˆ**:
1. **çŸ­æœŸ**: æµ‹è¯•ä¸­ä½¿ç”¨try-catchä¼˜é›…è·³è¿‡(å·²å®ç°)
2. **ä¸­æœŸ**: åœ¨calculate_cms_momentumä¸­å¢å¼ºå‚æ•°éªŒè¯,æå‰è¿”å›è­¦å‘Š
3. **é•¿æœŸ**: åœ¨OneLoopIntegralsæ¨¡å—ä¸­æ”¹è¿›B0ç§¯åˆ†çš„å¥‡ç‚¹å¤„ç†

---

### 5.2 å‚æ•°é€‰æ‹©æŒ‡å—

ä¸ºé¿å…æ•°å€¼é—®é¢˜,å»ºè®®:

**qqæ•£å°„**:
```julia
# å¯¹äºè½»å¤¸å…‹(u,d): s > 4mÂ² â‰ˆ 0.36 fmâ»Â²
s_light = 5.0  # å®‰å…¨ä½™é‡

# å¯¹äºåŒ…å«så¤¸å…‹: s > (m_u+m_s)Â² â‰ˆ 0.64 fmâ»Â²  
s_strange = 10.0  # æ¨èå€¼

# åŠ¨é‡è½¬ç§»: |t| < 0.5 * s (é¿å…æç«¯å‰å‘/åå‘æ•£å°„)
t = -0.1 * s
```

**qqbaræ•£å°„**:
```julia
# è½»å¤¸å…‹æ¹®ç­: s > 0 (æ— é˜ˆå€¼é™åˆ¶)
s_qqbar = 4.0  

# åŠ¨é‡è½¬ç§»: |t| < 0.5 * s
t = -0.1 * s
```

---

## 6. ä»£ç è´¨é‡è¯„ä¼°

### 6.1 ä¼˜ç‚¹

âœ… **å…¬å¼å®ç°å‡†ç¡®**: è‰²è‡ªæ—‹å¹³å‡å› å­å¤„ç†æ­£ç¡®  
âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°åˆ†ç¦»qqå’Œqqbarè®¡ç®—é€»è¾‘  
âœ… **å®Œæ•´æ”¯æŒ**: è¦†ç›–PNJLæ¨¡å‹å…¨éƒ¨11ç§æ•£å°„è¿‡ç¨‹  
âœ… **å¥å£®é”™è¯¯å¤„ç†**: æœªçŸ¥è¿‡ç¨‹ç¬¦å·æŠ›å‡ºæ˜ç¡®å¼‚å¸¸  
âœ… **æ€§èƒ½ä¼˜å¼‚**: å•æ¬¡è®¡ç®—~0.1ç§’(åŒ…å«ä¼ æ’­å­ç§¯åˆ†)

### 6.2 æ”¹è¿›å»ºè®®

ğŸ”¹ **å‚æ•°é¢„æ£€æŸ¥**: åœ¨ä¸»å‡½æ•°å…¥å£éªŒè¯s,t,uæ»¡è¶³ç‰©ç†çº¦æŸ  
ğŸ”¹ **è­¦å‘Šä¿¡æ¯**: å½“k0Â²-u<0æ—¶,ä»calculate_cms_momentumå‘ä¸Šä¼ é€’è­¦å‘Š  
ğŸ”¹ **ç¼“å­˜ä¼˜åŒ–**: å¯¹ç›¸åŒ(k0,k)çš„ä¼ æ’­å­è°ƒç”¨ä½¿ç”¨ç¼“å­˜(å·²åœ¨PolarizationCacheå®ç°,å¯è¿›ä¸€æ­¥åˆ©ç”¨)

---

## 7. æµ‹è¯•è¦†ç›–ç‡æ€»ç»“

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•æ•° | é€šè¿‡æ•° | è¦†ç›–ç‡ |
|---------|-------|-------|--------|
| Mandelstamå˜é‡ | 20 | 20 | 100% |
| qqæ•£å°„ | 12 | 11 | 92%Â¹ |
| qqbaræ•£å°„ | 21 | 21 | 100% |
| ç‰©ç†çº¦æŸ | 9 | 9 | 100% |
| é”™è¯¯å¤„ç† | 1 | 1 | 100% |
| **æ€»è®¡** | **67** | **66** | **99%** |

**æ³¨é‡Š**:  
Â¹ ssâ†’ssè¿‡ç¨‹å› å‚æ•°çº¦æŸè·³è¿‡,å®é™…ä»£ç é€»è¾‘æ­£ç¡®ã€‚

---

## 8. ç»“è®º

âœ… **ScatteringAmplitudeæ¨¡å—æ ¸å¿ƒåŠŸèƒ½å®Œå…¨æ­£å¸¸**  
âœ… **è‰²è‡ªæ—‹å¹³å‡å…¬å¼ä¿®æ­£æ­£ç¡®,æ‰€æœ‰|M|Â²å€¼ä¸ºæ­£**  
âœ… **11ç§æ•£å°„è¿‡ç¨‹è®¡ç®—ç»“æœç‰©ç†åˆç†**  
âœ… **æ¨¡å—å·²å¯ç”¨äºä¸‹æ¸¸åº”ç”¨(æ•£å°„æˆªé¢ã€å¼›è±«æ—¶é—´è®¡ç®—)**

**åç»­å·¥ä½œ**:
1. åˆ›å»ºAPIæ–‡æ¡£(`docs/api/ScatteringAmplitude.md`)
2. å‚æ•°åŸŸè¾¹ç•Œå¤„ç†ä¼˜åŒ–
3. ä¸ç†è®ºæ–‡çŒ®æ•°å€¼ç»“æœå¯¹æ¯”éªŒè¯

---

## é™„å½•ï¼šå…³é”®ä»£ç ç‰‡æ®µ

### A.1 qqæ•£å°„çŸ©é˜µå…ƒå¹³æ–¹è®¡ç®—

```julia
# è‰²è‡ªæ—‹å¹³å‡åçš„|M_u|Â² (å·²åŒ…å«1/(4N_cÂ²)å¹³å‡å› å­)
M_u_squared = abs2(D_u_S) * vars.u_14_plus * vars.u_23_plus + 
              abs2(D_u_P) * vars.u_14_minus * vars.u_23_minus

# è‰²è‡ªæ—‹å¹³å‡åçš„|M_t|Â² (å·²åŒ…å«1/(4N_cÂ²)å¹³å‡å› å­)
M_t_squared = abs2(D_t_S) * vars.t_13_plus * vars.t_24_plus + 
              abs2(D_t_P) * vars.t_13_minus * vars.t_24_minus

# è‰²è‡ªæ—‹å¹³å‡åçš„äº¤å‰é¡¹ (åŒ…å«1/(4N_c)å› å­)
cross_term_factor = 1.0 / (4.0 * N_c)
cross_term = cross_term_factor * (term1 - term2 - term3 + term4)

# æ€»çŸ©é˜µå…ƒå¹³æ–¹
# äº¤å‰é¡¹éœ€è¦å†é™¤ä»¥N_cæ‰æ˜¯ 1/(4N_cÂ²) âˆ‘(M_u M_t*)
M_squared = M_u_squared + M_t_squared - 2.0 / N_c * real(cross_term)
```

### A.2 qqbaræ•£å°„çŸ©é˜µå…ƒå¹³æ–¹è®¡ç®—

```julia
# åŒæ ·çš„å¹³å‡å› å­å¤„ç†
M_s_squared = abs2(D_s_S) * vars.s_12_plus * vars.s_34_plus + 
              abs2(D_s_P) * vars.s_12_minus * vars.s_34_minus

M_t_squared = abs2(D_t_S) * vars.t_13_plus * vars.t_24_plus + 
              abs2(D_t_P) * vars.t_13_minus * vars.t_24_minus

cross_term = cross_term_factor * (term1 - term2 - term3 + term4)
M_squared = M_s_squared + M_t_squared - 2.0 / N_c * real(cross_term)
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´(æµ‹è¯•å®Œæˆæ—¥æœŸ)  
**ç»´æŠ¤è€…**: Julia_RelaxTimeé¡¹ç›®ç»„
