# 2→2散射动量可视化 - Web演示

## 项目概述

本项目实现了量子场论中2→2散射过程的动量计算和可视化。给定入射粒子的动量，系统会：
1. 计算质心系参数
2. 通过Lorentz变换得到出射粒子动量
3. 计算并可视化动量可达域（椭球）

## 快速开始

### 1. 启动Julia HTTP服务器

在项目根目录下运行：

```powershell
julia server.jl
```

成功启动后会看到：
```
🚀 散射计算服务器启动中...
📍 服务地址: http://0.0.0.0:8080
📡 API端点:
   POST http://localhost:8080/compute
   GET  http://localhost:8080/health
```

### 2. 打开前端页面

在浏览器中打开：
```
web/index.html
```

或者双击 `web/index.html` 文件。

### 3. 输入参数并计算

默认参数：
- 入射粒子1动量: **p₁ = (0.5, 0.0, 1.8) fm⁻¹**
- 入射粒子2动量: **p₂ = (-0.5, 0.0, -1.8) fm⁻¹**
- 所有粒子质量: **m = 1.52 fm⁻¹**
- 质心系方向: **θ* = π/4**, **φ* = π/6**

点击"🚀 计算散射"按钮，即可看到：
- 右侧3D视图显示动量椭球和粒子动量箭头
- 左侧面板显示详细物理量

## 功能说明

### 输入参数

| 参数 | 说明 | 单位 |
|------|------|------|
| p₁ₓ, p₁ᵧ, p₁ᵧ | 入射粒子1的三动量分量 | fm⁻¹ |
| p₂ₓ, p₂ᵧ, p₂ᵧ | 入射粒子2的三动量分量 | fm⁻¹ |
| m₁, m₂, m₃, m₄ | 四个粒子的静止质量 | fm⁻¹ |
| θ* | 质心系中出射粒子的极角 | 弧度 (0 ~ π) |
| φ* | 质心系中出射粒子的方位角 | 弧度 (0 ~ 2π) |

### 输出结果

#### 物理不变量
- **√s**: 质心系总能量
- **p***: 质心系动量大小

#### Lorentz参数
- **β**: 质心系相对实验室系的速度（光速单位）
- **γ**: Lorentz因子

#### 出射动量
- **p₃**: 出射粒子3在实验室系的动量
- **p₄**: 出射粒子4在实验室系的动量

#### 椭球参数
- **中心**: 椭球在实验室系的中心位置
- **半轴长**: 三个主轴方向的半轴长度

#### 物理验证
- **能量守恒**: E₁ + E₂ = E₃ + E₄
- **动量守恒**: p₁ + p₂ = p₃ + p₄

### 3D可视化

- **红色箭头**: 入射粒子1 (p₁)
- **蓝色箭头**: 入射粒子2 (p₂)
- **绿色箭头**: 出射粒子3 (p₃)
- **橙色箭头**: 出射粒子4 (p₄)
- **半透明青色椭球**: 出射粒子3的动量可达域

**鼠标控制**:
- 左键拖动：旋转视角
- 滚轮：缩放
- 右键拖动：平移

## API文档

### POST /compute

计算散射过程。

**请求体** (JSON):
```json
{
  "p1x": 0.5,
  "p1y": 0.0,
  "p1z": 1.8,
  "p2x": -0.5,
  "p2y": 0.0,
  "p2z": -1.8,
  "m1": 1.52,
  "m2": 1.52,
  "m3": 1.52,
  "m4": 1.52,
  "theta_star": 0.785,
  "phi_star": 0.524
}
```

**响应** (JSON):
```json
{
  "success": true,
  "data": {
    "ellipsoid": {
      "center": [0.0, 0.0, 0.0],
      "axes_directions": [[...], [...], [...]],
      "half_lengths": [1.23, 1.23, 0.98]
    },
    "momenta": {
      "p1": [0.5, 0.0, 1.8],
      "p2": [-0.5, 0.0, -1.8],
      "p3": [...],
      "p4": [...],
      "E1": 2.41,
      "E2": 2.41,
      "E3": 2.41,
      "E4": 2.41
    },
    "physics": {
      "s": 23.17,
      "sqrt_s": 4.81,
      "p_star": 1.23,
      "beta": 0.0,
      "beta_vector": [0.0, 0.0, 0.0],
      "gamma": 1.0,
      "theta_star": 0.785,
      "phi_star": 0.524
    },
    "validation": {
      "is_valid": true,
      "energy_conservation": 1.23e-10,
      "momentum_conservation": 4.56e-11
    }
  },
  "error": null
}
```

### GET /health

健康检查端点。

**响应**: `200 OK`

## 测试

运行单元测试：

```powershell
# 测试坐标变换模块
julia test_unit/test_frame_transformations.jl

# 测试动量映射模块
julia test_unit/test_momentum_mapping.jl
```

## 技术栈

### 后端 (Julia)
- **HTTP.jl**: HTTP服务器
- **JSON3.jl**: JSON序列化
- **LinearAlgebra**: 线性代数运算

### 前端 (JavaScript)
- **Three.js**: 3D图形渲染
- **OrbitControls**: 相机控制
- **原生JavaScript**: 无框架依赖

## 物理原理

### 坐标系变换

使用仿射变换将质心系动量转换到实验室系：

```
p_lab = A · p_cms + b
```

其中：
- **A**: 旋转矩阵 `A = I + (γ-1)/β² · β⊗β`
- **b**: 平移向量 `b = γE*β`

### 椭球可达域

出射粒子的动量可达域形成椭球，通过特征分解计算：

```
S = A · Aᵀ
eigenvalues, eigenvectors = eig(S)
半轴长 = p* · √eigenvalues
```

### 守恒律验证

- **能量守恒**: `|E₁ + E₂ - E₃ - E₄| < 10⁻⁹`
- **动量守恒**: `|p₁ + p₂ - p₃ - p₄| < 10⁻⁹`
- **质壳条件**: `E² - p² = m²`

## 常见问题

### 1. 服务器无法启动

**问题**: `端口8080已被占用`

**解决**: 使用其他端口
```powershell
julia server.jl 8081
```
并在 `web/js/api.js` 中修改 `API_BASE_URL`。

### 2. 前端无法连接服务器

**问题**: 浏览器显示"无法连接到服务器"

**解决**:
1. 确保Julia服务器正在运行
2. 检查浏览器控制台是否有CORS错误
3. 确认 `api.js` 中的URL正确

### 3. 计算失败：阈值以下

**问题**: `Scattering is below threshold`

**解决**: 增大入射动量或减小粒子质量，确保 `√s > m₃ + m₄`。

### 4. 3D视图不显示

**问题**: 右侧黑屏或没有椭球

**解决**:
1. 确保网络连接正常（Three.js从CDN加载）
2. 检查浏览器控制台的JavaScript错误
3. 尝试其他现代浏览器（推荐Chrome/Edge）

## 性能优化

- 椭球渲染使用64×32细分（可在 `visualization.js` 中调整）
- 服务器单线程，但足够处理交互式计算
- 前端动画使用 `requestAnimationFrame` 确保流畅

## 扩展建议

### 增加新功能

1. **动画播放**: 自动扫描 θ* 和 φ* 参数
2. **轨迹绘制**: 显示出射粒子在椭球表面的运动轨迹
3. **批量计算**: 支持多组参数同时计算
4. **数据导出**: 导出计算结果为CSV/JSON

### 代码位置

- 添加Julia计算逻辑: `src/simulation/MomentumMapping.jl`
- 修改前端UI: `web/js/ui.js`
- 增强可视化: `web/js/visualization.js`

## 许可证

本项目为研究和教育目的开发，遵循项目根目录的许可证。

## 联系方式

如有问题或建议，请在项目仓库提交Issue。

---

**祝计算愉快！** 🎉
