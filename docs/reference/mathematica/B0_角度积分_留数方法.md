# B0 角度积分 - 留数方法

**日期**: 2025年11月9日  
**方法**: 符号参数化 + 留数定理处理奇点  
**文件**: `B0_fixed.wl` (修改版)

---

## 1. 方法概述

将角度积分中的 $A_0, A_2, D_0, D_1$ **作为常数参数**而非 $p$ 的函数，让 Mathematica 对通用有理函数进行符号积分，然后用留数定理处理可能的奇点。

### 1.1 被积函数

经过 $x = \cos\theta$ 替换后：

$$
I(p) = \int_{-1}^{1} \frac{a_0 + a_2 x^2}{d_0 + d_1 x} \, dx
$$

其中：
- $a_0 = \frac{f_\Phi^+(E_1, \mu_1)}{E_1}$ (各向同性分布)
- $a_2 = \frac{\xi p^2}{2E_1^2} \frac{\partial f_\Phi^+}{\partial E_1}$ (各向异性修正)
- $d_0 = \lambda^2 - 2\lambda E_1 - k^2 + m_1^2 - m_2^2$ (传播子常数项)
- $d_1 = 2kp$ (传播子角度项)

---

## 2. 奇点分析

### 2.1 极点位置

分母为零：$d_0 + d_1 x = 0$

$$
x_{\text{pole}} = -\frac{d_0}{d_1} = -\frac{\lambda^2 - 2\lambda E_1 - k^2 + m_1^2 - m_2^2}{2kp}
$$

### 2.2 极点在积分区间内的条件

极点在 $[-1, 1]$ 内 $\Leftrightarrow$ $|x_{\text{pole}}| < 1$

$$
\left|\frac{d_0}{d_1}\right| < 1 \quad \Leftrightarrow \quad |\lambda^2 - 2\lambda E_1 - k^2 + m_1^2 - m_2^2| < |2kp|
$$

**物理意义**: 传播子有在壳极点（on-shell pole），对应准粒子能谱的共振条件。

### 2.3 留数计算

在极点 $x_{\text{pole}}$ 处的留数：

$$
\text{Res}(x_{\text{pole}}) = \lim_{x \to x_{\text{pole}}} (x - x_{\text{pole}}) \frac{a_0 + a_2 x^2}{d_0 + d_1 x} = \frac{a_0 + a_2 x_{\text{pole}}^2}{d_1}
$$

简化为：

$$
\text{Res} = \frac{a_0 d_1^2 + a_2 d_0^2}{d_1^3}
$$

---

## 3. Mathematica 符号积分结果

### 3.1 实部（主值积分）

Mathematica 给出的条件表达式（使用 `ArcTanh`）：

$$
I_{\text{PV}}(p) = \frac{2a_0}{d_1} \text{ArcTanh}\left(\frac{d_1}{d_0}\right) + \frac{2a_2 d_0}{d_1^3} \left(-d_1 + d_0 \text{ArcTanh}\left(\frac{d_1}{d_0}\right)\right)
$$

**条件**: $(d_1 \leq 0 \land d_0 + d_1 > 0) \lor (d_1 > 0 \land d_0 > d_1)$

#### 等价的对数形式

利用 $\text{ArcTanh}(z) = \frac{1}{2}\ln\frac{1+z}{1-z}$，可以重写为：

$$
I_{\text{PV}}(p) = -\frac{2d_0 d_1 a_2 + (d_1^2 a_0 + d_0^2 a_2)[\ln|d_0 - d_1| - \ln|d_0 + d_1|]}{d_1^3}
$$

### 3.2 虚部（留数贡献）

当极点在 $[-1, 1]$ 内时，根据留数定理：

$$
\text{Im}[I(p)] = -\pi \cdot \text{Res} = -\pi \frac{a_0 d_1^2 + a_2 d_0^2}{d_1^3}
$$

Mathematica 形式：

```mathematica
((-I)*(a2*d0^2 + a0*d1^2)*Pi)/d1^3
```

### 3.3 完整结果

$$
I(p) = I_{\text{PV}}(p) + i \cdot \text{Im}[I(p)] \cdot \Theta(1 - |d_0/d_1|)
$$

其中 $\Theta$ 是 Heaviside 阶跃函数：

$$
\Theta(1 - |d_0/d_1|) = \begin{cases}
1 & \text{if } |d_0/d_1| < 1 \\
0 & \text{otherwise}
\end{cases}
$$

Mathematica 使用 `Piecewise` 表示：

```mathematica
I(p) = I_PV(p) + Piecewise[{{((-I)*(a2*d0^2 + a0*d1^2)*Pi)/d1^3, Abs[d0/d1] < 1}}, 0]
```

---

## 4. 物理解释

### 4.1 实部 - 色散关系

- **对数奇异性**: $\ln|d_0 - d_1| - \ln|d_0 + d_1|$ 反映了传播子极点结构
- **准粒子能谱修正**: 由介质中的色散关系决定
- **主值积分**: 绕过实轴上的极点

### 4.2 虚部 - 耗散与阻尼

- **Landau 阻尼**: 在热介质中，准粒子与集体激发耦合导致能量耗散
- **衰减宽度**: $\text{Im}[I] \propto \Gamma$ (decay width)
- **在壳条件**: 只有当 $|d_0| < |d_1|$ 时才有虚部，对应准粒子"在壳"

### 4.3 极点条件的物理意义

$$
|\lambda^2 - 2\lambda E_1 - k^2 + m_1^2 - m_2^2| < |2kp|
$$

- 左边：传播子常数项，依赖于夸克能量 $E_1$ 和外动量 $k$
- 右边：角度相关项的系数
- 当不等式满足时，存在某个角度 $\theta$ 使得传播子分母为零

这对应于**准粒子共振**或**Landau 阻尼条件**。

---

## 5. 与解析公式的对比

### 5.1 已知解析公式（Section 7.5）

$$
I_{\text{known}}(p) = -\frac{2D_0 D_1 N_2 + (D_1^2 N_0 + D_0^2 N_2) L(p)}{D_1^3}
$$

其中 $L(p) = \ln|D_0 - D_1| - \ln|D_0 + D_1|$。

### 5.2 Mathematica 结果

使用 `ArcTanh` 表示，但数学上等价（通过三角恒等式）。

### 5.3 新增内容

- **虚部**: 之前的公式**没有**包含虚部！
- **留数贡献**: 现在正确处理了极点在积分区间内的情况
- **物理完整性**: 包含了耗散效应

---

## 6. Julia 实现指南

### 6.1 完整代码

```julia
function B0_aniso_with_residue(k, k0; m1, m2, mu1, mu2, T, Phi, PhiBar, xi, Lambda)
    """
    计算 B0 积分（第一项），包含留数贡献的虚部
    
    参数:
    - k: 外动量大小 (GeV)
    - k0: 实数能量 (GeV)
    - m1, m2: 费米子有效质量 (GeV)
    - mu1, mu2: 化学势 (GeV)
    - T: 温度 (GeV)
    - Phi, PhiBar: Polyakov 圈期望值
    - xi: 各向异性参数
    - Lambda: 紫外截断 (GeV)
    
    返回: Complex{Float64}
    """
    beta = 1.0 / T
    lambda = k0 + mu1 - mu2
    
    function integrand(p)
        E1 = sqrt(m1^2 + p^2)
        
        # 计算 PNJL 分布函数
        f_phi_plus, df_phi_plus = compute_pnjl_distribution(E1, mu1, beta, Phi, PhiBar)
        
        # 符号参数
        a0 = f_phi_plus / E1
        a2 = (xi * p^2 / (2 * E1^2)) * df_phi_plus
        d0 = lambda^2 - 2*lambda*E1 - k^2 + m1^2 - m2^2
        d1 = 2*k*p
        
        # 检查除零
        if abs(d1) < 1e-15
            return complex(0.0, 0.0)
        end
        
        # 实部：主值积分
        # 使用对数形式（数值更稳定）
        if abs(d0 - d1) < 1e-15 || abs(d0 + d1) < 1e-15
            # 极点在边界上，使用近似处理
            Lpole = 0.0
        else
            Lpole = log(abs(d0 - d1)) - log(abs(d0 + d1))
        end
        Ipv = -(2*d0*d1*a2 + (d1^2*a0 + d0^2*a2)*Lpole) / d1^3
        
        # 虚部：留数贡献
        pole_ratio = abs(d0 / d1)
        if pole_ratio < 1.0  # 极点在 [-1, 1] 内
            Iim = -π * (a0*d1^2 + a2*d0^2) / d1^3
        else
            Iim = 0.0
        end
        
        # 组合复数结果
        Ip = complex(Ipv, Iim)
        
        # 前因子
        prefactor = 2 * p^2 / E1
        
        return prefactor * Ip
    end
    
    # 对动量积分
    result, error = quadgk(integrand, 0.0, Lambda, rtol=1e-8)
    
    return 8 * π^2 * result
end

# 辅助函数：计算 PNJL 分布及其导数
function compute_pnjl_distribution(E, mu, beta, Phi, PhiBar)
    exp1 = exp(-beta * (E - mu))
    exp2 = exp1^2
    exp3 = exp1^3
    
    # 分子
    numer = Phi * exp1 + 2 * PhiBar * exp2 + exp3
    
    # 分母
    denom = 1 + 3 * Phi * exp1 + 3 * PhiBar * exp2 + exp3
    
    # f_Phi^+
    f = numer / denom
    
    # ∂f/∂E (使用商法则和链式法则)
    dnumer = -beta * (Phi * exp1 + 4 * PhiBar * exp2 + 3 * exp3)
    ddenom = -beta * (3 * Phi * exp1 + 6 * PhiBar * exp2 + 3 * exp3)
    df = (dnumer * denom - numer * ddenom) / denom^2
    
    return f, df
end
```

### 6.2 使用示例

```julia
# 物理参数
k = 0.5      # GeV
k0 = 0.3     # GeV
m1 = 0.1     # GeV
m2 = 0.1     # GeV
mu1 = 0.0    # GeV
mu2 = 0.0    # GeV
T = 0.2      # GeV (~ 160 MeV)
Phi = 0.5
PhiBar = 0.5
xi = 0.1
Lambda = 2.0 # GeV

# 计算 B0
B0_result = B0_aniso_with_residue(k, k0; 
    m1=m1, m2=m2, mu1=mu1, mu2=mu2, 
    T=T, Phi=Phi, PhiBar=PhiBar, xi=xi, Lambda=Lambda)

println("B0 = ", real(B0_result), " + i*", imag(B0_result))
println("  |B0| = ", abs(B0_result))
println("  arg(B0) = ", angle(B0_result), " rad")
```

### 6.3 数值稳定性建议

1. **对数形式 vs ArcTanh**:
   - 使用 `log(abs(d0-d1)) - log(abs(d0+d1))` 而非直接计算 `log((d0-d1)/(d0+d1))`
   - 避免 `d0-d1` 接近零时的数值误差

2. **极点检测**:
   - 使用阈值 `abs(d0/d1) < 1.0 - eps` 来判断，其中 `eps = 1e-10`
   - 避免极点恰好在边界 $x = \pm 1$ 时的数值问题

3. **积分器选择**:
   - `quadgk` 能自动处理被积函数的奇异性
   - 设置合理的 `rtol` 和 `atol`（建议 `1e-8` 或更小）

---

## 7. 与 B0_第一项解析结果.md 的关系

### 7.1 原文档的不足

原文档（Section 7.5）给出的解析公式**只包含实部**：

$$
I_{\text{old}}(p) = -\frac{2D_0 D_1 N_2 + (D_1^2 N_0 + D_0^2 N_2) L(p)}{D_1^3}
$$

**问题**: 
- 没有虚部！
- 未考虑传播子极点在积分区间内的情况
- 缺少物理上的耗散/阻尼效应

### 7.2 本文档的改进

1. **完整的复数结果**: $I(p) = I_{\text{PV}}(p) + i \cdot \text{Im}[I(p)]$
2. **留数定理**: 正确处理奇点贡献
3. **物理解释**: 虚部对应 Landau 阻尼和准粒子衰减宽度

### 7.3 建议

- 更新 `B0_第一项解析结果.md` 的 Section 7.5
- 添加虚部的计算和物理意义
- 在 Julia 实现中默认包含留数贡献

---

## 8. 验证与测试

### 8.1 极限情况检查

1. **$\xi = 0$ (各向同性)**:
   - $a_2 = 0$
   - 虚部简化为 $\text{Im}[I] = -\pi a_0$ (如果极点在内)

2. **$k = 0$ (静态极限)**:
   - $d_1 = 0$，积分变为常数（无角度依赖）
   - 需要单独处理

3. **$|d_0| \gg |d_1|$ (极点远离积分区间)**:
   - 虚部 $\approx 0$
   - 只有实部贡献

### 8.2 与 Mathematica 数值对比

可以用特定参数值在 Mathematica 中数值积分，与 Julia 实现对比：

```mathematica
(* Mathematica numerical test *)
k = 0.5; k0 = 0.3; m1 = 0.1; m2 = 0.1; 
mu1 = 0.0; mu2 = 0.0; beta = 5.0;
Phi = 0.5; PhiBar = 0.5; xi = 0.1;
p = 1.0; (* sample momentum *)

(* 计算 a0, a2, d0, d1 ... *)
(* 然后数值积分 *)
NIntegrate[(a0 + a2*x^2)/(d0 + d1*x), {x, -1, 1}, 
  Method -> "PrincipalValue"]
```

---

## 9. 总结

### 9.1 主要成果

1. ✅ 将 Mathematica 符号积分应用于参数化的有理函数
2. ✅ 使用留数定理正确处理奇点
3. ✅ 得到完整的复数结果（实部 + 虚部）
4. ✅ 提供了紧凑的解析表达式和 Julia 实现

### 9.2 物理意义

- **实部**: 描述色散关系和准粒子能谱修正
- **虚部**: 描述 Landau 阻尼和集体激发的衰减
- **极点条件**: 反映准粒子共振和在壳传播

### 9.3 下一步工作

1. 实现并测试 Julia 代码
2. 与数值积分结果对比验证
3. 分析虚部对弛豫时间的影响
4. 推广到 B0 的其他三项（$f_1^-, f_2^+, f_2^-$）

---

## 参考文献

1. HD-TVP-95-13: One Loop Integrals at Finite Temperature and Density (P. Rehberg and S. P. Klevansky)
2. Residue Theorem in Complex Analysis (标准教材)
3. Landau Damping in Plasma Physics (物理背景)
4. PNJL Model and Polyakov Loop (QCD 相变理论)

---

**文件版本**: v1.0  
**生成时间**: 2025-11-09  
**对应 Mathematica 脚本**: `B0_fixed.wl` (修改版，包含留数处理)
