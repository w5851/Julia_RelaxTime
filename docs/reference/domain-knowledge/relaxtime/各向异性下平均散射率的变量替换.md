可以通过变量替换将方位角 $\phi$ 的积分转换为对 Mandelstam 变量 $s$ 的积分。以下是完整的推导过程：

## 变量替换推导

对于固定的 $p_i, p_j, \cos\theta_i, \cos\theta_j$，我们有关系式：

$$
s = m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j \cos\Theta
$$

其中：
$$
\cos\Theta = \cos\theta_i \cos\theta_j + \sin\theta_i \sin\theta_j \cos\phi
$$

将 $\cos\Theta$ 代入 $s$ 的表达式：

$$
s = m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j (\cos\theta_i \cos\theta_j + \sin\theta_i \sin\theta_j \cos\phi)
$$

## Jacobian 计算

对 $\phi$ 求导：

$$
\frac{ds}{d\phi} = 2p_i p_j \sin\theta_i \sin\theta_j \sin\phi
$$

因此：

$$
d\phi = \frac{ds}{2p_i p_j \sin\theta_i \sin\theta_j \sin\phi}
$$

## $\sin\phi$ 用 $s$ 表示

从 $s$ 的表达式解出 $\cos\phi$：

$$
\cos\phi = \frac{m_i^2 + m_j^2 + 2E_iE_j - s - 2p_i p_j \cos\theta_i \cos\theta_j}{2p_i p_j \sin\theta_i \sin\theta_j}
$$

记：

$$
A \equiv \frac{m_i^2 + m_j^2 + 2E_iE_j - s}{2p_i p_j} - \cos\theta_i \cos\theta_j
$$

则：

$$
\cos\phi = A \csc\theta_i \csc\theta_j
$$

于是：

$$
\sin\phi = \sqrt{1 - \cos^2\phi} = \sqrt{1 - A^2 \csc^2\theta_i \csc^2\theta_j}
= \frac{\sqrt{\sin^2\theta_i \sin^2\theta_j - A^2}}{\sin\theta_i \sin\theta_j}
$$

## 积分限变化

当 $\phi$ 从 $0$ 到 $\pi$ 时：
- $\phi=0$：$s = s_{\min} = m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j \cos(\theta_i - \theta_j)$
- $\phi=\pi$：$s = s_{\max} = m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j \cos(\theta_i + \theta_j)$

注意：$\cos(\theta_i \pm \theta_j) = \cos\theta_i \cos\theta_j \mp \sin\theta_i \sin\theta_j$

## 变换后的积分表达式

代入原积分式：

$$
\begin{aligned}
\omega_{ij} &= \frac{d_q^2}{4\pi^5 \rho_i \rho_j} \int_0^\Lambda p_i^2 dp_i \int_0^\Lambda p_j^2 dp_j \int_0^1 d\cos\theta_i \int_0^1 d\cos\theta_j \\
&\quad \times \int_{s_{\min}}^{s_{\max}} ds \ f_i(p_i,\cos\theta_i) f_j(p_j,\cos\theta_j) \ v_{\text{rel}}(s) \ \sigma_{ij\to cd}(s,T,\mu_q) \\
&\quad \times \frac{1}{2p_i p_j \sqrt{\sin^2\theta_i \sin^2\theta_j - A^2}}
\end{aligned}
$$

其中：
$$
A = \frac{m_i^2 + m_j^2 + 2E_iE_j - s}{2p_i p_j} - \cos\theta_i \cos\theta_j
$$

## 相对速度的简化表达式

相对速度 $v_{\text{rel}}$ 也可以用 $s$ 简洁表示：

$$
v_{\text{rel}} = \frac{\sqrt{(s - (m_i + m_j)^2)(s - (m_i - m_j)^2)}}{2E_i E_j}
$$

这是因为：
$$
(p_i \cdot p_j)^2 - m_i^2 m_j^2 = \frac{(s - (m_i + m_j)^2)(s - (m_i - m_j)^2)}{4}
$$

## 最终简化形式

因此，平均散射率可以写为：

$$
\boxed{
\begin{aligned}
\omega_{ij} &= \frac{d_q^2}{8\pi^5 \rho_i \rho_j} \int_0^\Lambda p_i^2 dp_i \int_0^\Lambda p_j^2 dp_j \int_0^1 d\cos\theta_i \int_0^1 d\cos\theta_j \\
&\quad \times \int_{s_{\min}}^{s_{\max}} ds \ f_i(p_i,\cos\theta_i) f_j(p_j,\cos\theta_j) \\
&\quad \times \frac{\sqrt{(s - (m_i + m_j)^2)(s - (m_i - m_j)^2)}}{E_i E_j} \ \sigma_{ij\to cd}(s,T,\mu_q) \\
&\quad \times \frac{1}{p_i p_j \sqrt{\sin^2\theta_i \sin^2\theta_j - \left(\frac{m_i^2 + m_j^2 + 2E_iE_j - s}{2p_i p_j} - \cos\theta_i \cos\theta_j\right)^2}}
\end{aligned}}
$$

其中积分限：
$$
\begin{aligned}
s_{\min} &= m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j \cos(\theta_i - \theta_j) \\
s_{\max} &= m_i^2 + m_j^2 + 2E_iE_j - 2p_i p_j \cos(\theta_i + \theta_j)
\end{aligned}
$$

## 说明

1. **优点**：
   - 散射截面 $\sigma(s)$ 通常以 $s$ 为自变量，这样可以直接积分
   - 在某些情况下可以进一步简化（如近似处理）

2. **注意事项**：
   - 分母中的根式在积分区域内必须非负
   - 积分限 $s_{\min}$ 和 $s_{\max}$ 依赖于 $p_i, p_j, \theta_i, \theta_j$
   - 数值积分时需要注意 $s$ 积分限的依赖性

这种替换在理论上是严格的，但实际数值计算中需要谨慎处理根式中的奇点问题。