# 2026-01-22 整理项目结构

目标：检查并整理项目结构，尤其是根目录（repo root）中“需要长期保留/应该移动/应当忽略或删除”的内容，确保结构清晰、可复现、不引入隐性依赖。

## 约束与原则（必须遵守）

1. 不破坏工具链默认约定：
	- Julia：`Project.toml`、`Manifest.toml` 必须保留在仓库根目录。
	- Node：`package.json`、`package-lock.json` 必须保留在仓库根目录。
	- Python：`requirements.txt` 保留在仓库根目录（或同步更新 README/INSTALL 入口后才可迁移）。
2. 只移动“文档/结果/非入口性说明”等，不移动会被工具链硬编码读取的文件。
3. 任何移动/重命名都要同步更新引用（README、docs 内链接、脚本内路径）。
4. 生成物不进仓库：`node_modules/`、`.venv/`、临时输出/缓存应确保被 `.gitignore` 覆盖。

## 当前结构快照（2026-01-22）

根目录包含：

- 目录：`.git/`, `.github/`, `.vscode/`, `.venv/`, `node_modules/`, `agent_rules/`, `config/`, `data/`, `docs/`, `scripts/`, `src/`, `tests/`, `web/`
- 文件：`.gitignore`, `Desktop.ini`, `INSTALL.md`, `LICENSE`, `Manifest.toml`, `package-lock.json`, `package.json`, `Project.toml`, `README.md`, `requirements.txt`

观察：

- `Desktop.ini` 属于 Windows/Explorer 生成物，应从仓库中移除并加入忽略规则。
- `node_modules/` 与 `.venv/` 属于本地环境产物，通常不应进入 git（若已进入，需要清理并补全忽略）。

## 任务范围

本任务聚焦“根目录文件分类整理 + 结构一致性校验”，不涉及物理/数值实现变更。

## 计划（建议流程）

### Step 1：盘点与分类（只读）

1) 输出根目录清单并按以下四类打标签：

- **必须留在根目录**：工具链入口与项目元数据（例如 `Project.toml` / `Manifest.toml` / `package.json` / `README.md` / `LICENSE`）。
- **建议留在根目录（入口文档）**：例如 `INSTALL.md`（若决定迁移到 `docs/guides/`，需同步更新 README 入口）。
- **应移动到对应目录**：例如零散报告/草稿应进入 `docs/`，脚本进入 `scripts/`，数据输出进入 `data/outputs/`。
- **应忽略或删除**：例如 `Desktop.ini`、`node_modules/`、`.venv/`、临时日志与缓存。

2) 检查 `.gitignore` 是否覆盖：

- `Desktop.ini`
- `node_modules/`
- `.venv/`
- `data/outputs/**` 中不应提交的大体积/可再生结果（按现有约定细化）

产出：一份“动作清单”（move/delete/keep + 理由）。

### Step 2：执行整理（可回滚）

按 Step 1 的动作清单执行：

- 删除或从 git 移除：`Desktop.ini`；确保加入 `.gitignore`。
- 确认 `node_modules/`、`.venv/` 均不被 git 跟踪（必要时 `git rm -r --cached`）。
- 若决定迁移根目录的说明文档（例如 `INSTALL.md`），则：
	- 新位置建议：`docs/guides/INSTALL.md`
	- 同步更新：`README.md` 中的链接与引用。

### Step 2.5：归档整理 docs 下“裸文档”（本轮新增）

目标：把以下目录“根目录下的裸文档（直接散落的 .md 文件）”收拢到 `archived/` 子目录中，避免目录根部越来越杂：

- `docs/api/`
- `docs/reference/domain-knowledge/`
- `docs/reference/formula/`

执行方式：

- 为每个目录创建 `archived/` 子目录。
- 仅移动该目录**根部**的 `.md` 文件到 `archived/`（保留既有子目录结构，如 `pnjl/`、`relaxtime/` 等）。
- 使用 `git mv` 保留历史；随后进行一次全局断链检查并修正文档引用。

### Step 3：引用一致性与断链检查

全局搜索以下类型引用并修正：

- 文档链接：`(INSTALL.md)`、`(README.md)`、以及任何被迁移文件的相对链接。
- 脚本路径：硬编码指向旧位置的 `include("...")` / `joinpath` / CLI usage。

### Step 4：验证（最小可运行性）

- Julia：`Pkg.activate("."); Pkg.instantiate()` 不报错。
- Node（如仓库需要）：`npm install` 能正常完成（不要求提交 `node_modules/`）。
- 最小测试：运行一组关键单元测试（优先选择执行快、覆盖面大的）。

### Step 5：文档收尾与归档

- 在本任务文档中记录最终结构决策（哪些保留根目录、哪些迁移、哪些忽略）。
- 任务完成后将本文件从 `docs/dev/active/` 归档到 `docs/dev/archived/`（按仓库归档规则保留元信息与原文）。

## 验收标准

1) 根目录仅包含“必要的项目入口/元数据”，不存在 OS 生成物与可再生依赖目录被 git 跟踪。
2) `.gitignore` 覆盖常见本地生成物（至少 `Desktop.ini`、`node_modules/`、`.venv/`）。
3) 文档/脚本引用无断链（至少对本次移动/删除的文件做到全局修正）。
4) 最小可运行性验证通过（Julia instantiate + 关键测试）。

## 执行记录（2026-01-22）

- 已在 `.gitignore` 增加 `.venv/` 忽略规则。
- 已验证 `node_modules/` 与 `.venv/` 当前均未被 git 跟踪，且会被 `.gitignore` 忽略（不会出现在 `git status`）。
- `Desktop.ini` 已被 `.gitignore` 忽略；如需进一步“物理清理根目录”，可在本地删除该文件（不影响仓库）。
- 发现 `data/outputs/` 目录下已有部分图像/CSV 结果被 git 跟踪；当前决策：暂时保留这些已跟踪文件（不做忽略/清理），以保持历史结果与文档引用稳定。
- 已将 `docs/api/`、`docs/reference/domain-knowledge/`、`docs/reference/formula/` 三处目录根部的裸 `.md` 文档统一移动到各自的 `archived/` 子目录，并将外部引用更新到新路径。