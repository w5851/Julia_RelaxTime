# 下一步：弛豫时间对比计划

**日期**: 2026-01-26
**状态**: 准备提取 Fortran 弛豫时间并进行对比

---

## 🎯 当前状态

### ✅ 已验证一致的物理量

| 物理量 | Fortran | Julia | 差异 | 状态 |
|--------|---------|-------|------|------|
| Φ (Polyakov 环) | 0.8404 | 0.8382 | 0.26% | ✅ |
| m_u (有效质量) | 0.04051 fm⁻¹ | 0.04122 fm⁻¹ | 1.75% | ✅ |
| m_s (有效质量) | 1.0323 fm⁻¹ | 1.0482 fm⁻¹ | 1.54% | ✅ |
| A_u (单圈积分) | -4.972 fm⁻² | -4.986 fm⁻² | 0.28% | ✅ |
| A_s (单圈积分) | -5.166 fm⁻² | -5.183 fm⁻² | 0.33% | ✅ |
| G_u (有效耦合) | 0.0153 fm⁻³ | 0.0156 fm⁻³ | 2.0% | ✅ |
| G_s (有效耦合) | 0.405 fm⁻³ | 0.413 fm⁻³ | 2.0% | ✅ |
| ρ_u (数密度) | 1.681 fm⁻³ | 1.694 fm⁻³ | 0.8% | ✅ |
| ρ_s (数密度) | 1.538 fm⁻³ | 1.550 fm⁻³ | 0.8% | ✅ |

**所有基础物理量差异 < 2%!**

### ❓ 待验证的量

- **弛豫时间 τ**: 报告相差 3 倍 (待验证)
- **平均散射率 w_ij**: 未对比
- **总截面 σ(s)**: 未对比
- **散射振幅 M²**: 未对比

---

## 📋 执行步骤

### 第一步：重新编译 Fortran 代码 ✅

已在 `z1 relax_time.f90` 中添加了详细的调试输出:
- 数密度
- 弛豫时间 τ
- 散射率 Γ = 1/τ
- 所有平均散射率 w_ij

**操作**:
```powershell
cd relaxtime_fortran
.\compile_gfortran.ps1
```

或使用 Intel Fortran:
```powershell
ifort /O2 /Qopenmp codes\*.f90 -o relaxtime.exe
```

### 第二步：运行 Fortran 代码并保存输出

**操作**:
```powershell
cd relaxtime_fortran
.\relaxtime.exe > results\debug_relaxtime.txt 2>&1
```

或在 Linux/Mac:
```bash
cd relaxtime_fortran
./relaxtime > results/debug_relaxtime.txt 2>&1
```

### 第三步：运行 Julia 对比脚本

**操作**:
```bash
cd Julia_RelaxTime
julia scripts/relaxtime/extract_and_compare_relaxation_times.jl
```

这个脚本会:
1. 从 Fortran 输出中提取弛豫时间
2. 使用 Julia 计算相同条件下的弛豫时间
3. 对比两者的结果
4. 输出详细的对比报告

### 第四步：分析差异

根据对比结果,确定差异的来源:

#### 情况 A: 弛豫时间一致 (差异 < 10%)

**结论**: 之前报告的 3 倍差异可能是:
- 使用了不同的参数 (Φ, m, T, μ)
- 单位换算错误
- 数据提取错误

**下一步**: 
- 验证原始报告的数据来源
- 检查单位换算
- 更新文档

#### 情况 B: 弛豫时间仍有显著差异 (> 50%)

**需要逐步检查计算链**:

1. **平均散射率 w_ij**
   - 对比每个散射过程的 w_ij
   - 找出哪些过程有差异
   
2. **总截面 σ(s)**
   - 对比相同 s 值下的 σ(s)
   - 检查积分范围和方法
   
3. **散射振幅 M²**
   - 对比相同动量下的 M²
   - 检查有效耦合系数的使用
   
4. **微分截面 dσ/dt**
   - 对比相同 s, t 下的 dσ/dt
   - 检查传播子的计算

---

## 🔍 弛豫时间计算链

```
能隙方程 → (Φ, m) ✅
    ↓
A 函数 → A_f ✅
    ↓
G^f = -3/(4π²) × m_f × A_f ✅
    ↓
有效耦合系数 K ❓
    ↓
散射振幅 M² ❓
    ↓
微分截面 dσ/dt ❓
    ↓
总截面 σ(s) ❓
    ↓
散射率 w_ij ❓
    ↓
平均散射率 Γ_i = Σ_j ρ_j × w_ij ❓
    ↓
弛豫时间 τ_i = 1/Γ_i ❓
```

---

## 📊 Fortran 调试输出格式

预期的 Fortran 输出格式:

```
========================================================================
DEBUG: Relaxation times at T=   29.595000000000002      MeV, mu_B=   78.920000000000002      MeV
------------------------------------------------------------------------
Densities (fm^-3):
  n_u  =   1.6810000000000000     
  n_ub =   1.6810000000000000     
  n_s  =   1.5380000000000000     
  n_sb =   1.5380000000000000     
------------------------------------------------------------------------
Relaxation times (fm):
  tau_u  =   1.2345678901234567E-002
  tau_s  =   3.4567890123456789E-003
  tau_ub =   1.2345678901234567E-002
  tau_sb =   3.4567890123456789E-003
------------------------------------------------------------------------
Scattering rates Gamma = 1/tau (fm^-1):
  Gamma_u  =   81.000000000000000     
  Gamma_s  =   289.35000000000002     
  Gamma_ub =   81.000000000000000     
  Gamma_sb =   289.35000000000002     
------------------------------------------------------------------------
Average scattering rates w_ij (fm^-1):
  w(1)  ud->ud       =   1.2345678901234567E-002
  w(2)  uu->uu       =   2.3456789012345678E-002
  ...
========================================================================
```

---

## 🎓 物理理解

### 弛豫时间的定义

**Fortran**:
```fortran
tau_u = 1 / (n_u*(w_uu + w_ud) + n_ub*(w_uubar + w_uubar_ddbar + w_uubar_ssbar + w_udbar) + n_s*w_us + n_sb*w_usbar)
```

**Julia**:
```julia
Γ_u = n_u*(w_uu + w_ud) + n_ubar*(w_uubar + w_uubar_ddbar + w_uubar_ssbar + w_udbar) + n_s*w_us + n_sbar*w_usbar
tau_u = 1 / Γ_u
```

**公式一致!** 如果有差异,必然来自:
1. 数密度 n_i (已验证一致 ✅)
2. 平均散射率 w_ij (待验证 ❓)

### 平均散射率的定义

```
w_ij = (N_c² / (2π⁴)) × ∫∫∫ d³p_i d³p_j dΩ × f_i(p_i) × f_j(p_j) × σ_ij(s) × v_rel
       ────────────────────────────────────────────────────────────────────────────
                                    n_i × n_j
```

其中:
- `f_i(p)`: 分布函数 (已验证一致 ✅)
- `σ_ij(s)`: 总截面 (待验证 ❓)
- `v_rel`: 相对速度
- `n_i`: 数密度 (已验证一致 ✅)

**如果 w_ij 有差异,必然来自 σ_ij(s)!**

---

## 📚 相关文档

- `COMPLETE_RESOLUTION.md`: 完整解决方案总结
- `INVESTIGATION_SUMMARY_FINAL.md`: 之前的调查总结
- `FORTRAN_DEBUG_INSTRUCTIONS.md`: Fortran 调试指南
- `extract_and_compare_relaxation_times.jl`: Julia 对比脚本

---

## ⚠️ 注意事项

### 单位

- Fortran: 使用自然单位 (fm, fm⁻¹)
- Julia: 使用自然单位 (fm, fm⁻¹)
- 输出时需要转换: `T*hc` (MeV), `μ*hc` (MeV)

### 数值精度

- Fortran: 双精度 `real(dp)`
- Julia: `Float64`
- 预期数值误差 < 1e-12

### 积分方法

- Fortran: 使用半无穷积分 (变量替换 `p = scale * t / (1-t)`)
- Julia: 使用半无穷积分 (相同方法)
- 应该一致!

---

## 🎯 预期结果

### 最佳情况

- 弛豫时间差异 < 10%
- 所有平均散射率差异 < 10%
- 确认之前的 3 倍差异是参数或单位问题

### 最坏情况

- 弛豫时间仍相差 > 2 倍
- 需要逐步检查:
  1. 平均散射率 w_ij
  2. 总截面 σ(s)
  3. 散射振幅 M²
  4. 微分截面 dσ/dt

---

*文档时间: 2026-01-26*
*状态: 已添加 Fortran 调试输出,准备运行对比*
*下一步: 重新编译 Fortran → 运行 → 提取数据 → 对比*
