# 单位分析：找出真正的问题

**日期**: 2026-01-26

---

## 📐 Julia 的单位分析

### calculate_G_from_A

```julia
G_f = -Nc / (4.0 * π^2) * (m_f * A_f)
```

**单位**：
- `Nc`: 无量纲
- `m_f`: fm⁻¹
- `A_f`: fm⁻²

```
G_f 单位 = 无量纲 × fm⁻¹ × fm⁻² = fm⁻³
```

**但文档说 G^f 应该是无量纲的！**

### 数值
```
G_u = 0.015282 fm²  （这是我们计算出来的）
```

**矛盾**：单位分析说应该是 fm⁻³，但数值显示是 fm²！

---

## 📐 Fortran 的单位分析

### quantity.f90

```fortran
arrG(:) = - arrMass(:) * arrA(:) * (3d0*K_f) / (4d0*pi**2)
```

**单位**：
- `arrMass`: fm⁻¹
- `arrA`: fm⁻²
- `K_f`: fm⁵
- `3d0`: 无量纲
- `4d0*pi**2`: 无量纲

```
arrG 单位 = fm⁻¹ × fm⁻² × fm⁵ / 无量纲 = fm²
```

### 数值
```
arrG(u) = 0.000714 fm²
```

**一致**：单位分析和数值都是 fm²。

---

## 🔍 问题在哪里？

### Julia 的 A_f 单位

让我检查 A 函数的定义...

从文档：
```
A_f(T, μ) = 16π² ∫ d³p/(2π)³ [1 - n_f⁺/(2E) - n_f⁻/(2E)]
```

**单位分析**：
- `d³p/(2π)³`: fm⁻³
- `1/(2E)`: fm
- 积分：fm⁻³ × fm = fm⁻²

所以 `A_f` 的单位是 fm⁻²。✅

### Julia 的 G_f 单位（重新计算）

```julia
G_f = -Nc / (4.0 * π^2) * (m_f * A_f)
    = -3 / (4π²) * m_f * A_f
```

单位：
```
G_f = 无量纲 × fm⁻¹ × fm⁻² = fm⁻³
```

**但是**，如果我们看实际的数值：

```
G_u = -3 / (4π²) * 0.040510 * (-4.964141)
    = -0.07598 * 0.040510 * (-4.964141)
    = 0.015282
```

这个数值的单位应该是 fm⁻³，但我们之前说它是 fm²...

---

## 🎯 真相大白

### Julia 的 G_f 实际上是 fm⁻³

```
G_u = 0.015282 fm⁻³  （不是 fm²！）
```

### Fortran 的 arrG 是 fm²

```
arrG(u) = 0.000714 fm²
```

### 它们的关系

如果 Fortran 的 `arrG = K_f * G^f`（无量纲），那么：

```
arrG 单位 = fm⁵ × 无量纲 = fm⁵  （不对！）
```

如果 Fortran 的 `arrG = K_f * [某个有单位的量]`，那么：

```
arrG = K_f * [fm⁻³的量]
     = fm⁵ × fm⁻³
     = fm²  ✅
```

**所以**：
- Julia 的 `G_f` 单位是 fm⁻³
- Fortran 的 `arrG = K_f * G_f`，单位是 fm²

### 验证

```
arrG(u) = K_f * G_u
0.000714 = 0.00519 * G_u
G_u = 0.000714 / 0.00519 = 0.1376 fm⁻³
```

但 Julia 计算的是：
```
G_u = 0.015282 fm⁻³
```

比值：
```
0.015282 / 0.1376 = 0.111
```

**还是不对！**

---

## 🔄 重新检查 A 的单位

让我检查 Fortran 的 A 计算...

从 `quantity.f90`:
```fortran
arrA(:) = arrA(:) + w1(i) * p**2 * ( arrFq(1,:) + arrFq(2,:) ) / arrEi(:)
...
arrA(:) = arrA(:) * 4d0
```

这里 `arrA` 在循环中累加，最后乘以 4。

**单位**：
- `w1(i)`: 积分权重（无量纲）
- `p**2`: fm⁻²
- `arrFq`: 分布函数（无量纲）
- `arrEi`: 能量（fm⁻¹）

```
arrA 单位 = 无量纲 × fm⁻² × 无量纲 / fm⁻¹ = fm⁻¹
```

**等等！Fortran 的 A 单位是 fm⁻¹，不是 fm⁻²！**

---

## 🎯 最终答案

### Fortran 的单位

```
arrA: fm⁻¹
arrMass: fm⁻¹
K_f: fm⁵

arrG = - arrMass * arrA * (3 * K_f) / (4π²)
     = fm⁻¹ × fm⁻¹ × fm⁵ / 无量纲
     = fm³
```

**不对！这应该是 fm²！**

让我重新检查 Fortran 的 A 计算...

---

## 📝 需要做的

1. 检查 Fortran 的 A 函数的完整实现
2. 确认 A 的单位
3. 确认 arrG 的单位
4. 找出单位不匹配的地方
