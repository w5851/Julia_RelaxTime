# A å‡½æ•°å½’ä¸€åŒ–å¯¹æ¯”ï¼šFortran vs Julia

**æ—¥æœŸ**: 2026-01-26
**ç»“è®º**: **æ‰¾åˆ°äº†å…³é”®å·®å¼‚ï¼**

---

## ğŸ“ Fortran çš„ A å‡½æ•°

### ä»£ç ï¼ˆ`quantity.f90`ï¼‰

```fortran
arrA(:) = 0d0

! çœŸç©ºé¡¹ï¼ˆå¸¸æ•°é¡¹ï¼‰
do i = 1, npoint, 1
    p = y(i)
    arrEi(:) = sqrt(p**2 + arrMass(:)**2)
    arrA(:) = arrA(:) + w(i) * p**2 * (-1d0) / arrEi(:)
end do

! æœ‰é™æ¸©åº¦é¡¹ï¼ˆåˆ†å¸ƒå‡½æ•°é¡¹ï¼‰
do i = 1, npoint1, 1
    p = y1(i)
    arrEi(:) = sqrt(p**2 + arrMass(:)**2)
    do k = 1, 3, 1
        arrFq(1,k) = fphi(arrEi(k) - arrMu(k), T, Phi1, Phi2)
        arrFq(2,k) = fphibar(arrEi(k) + arrMu(k), T, Phi1, Phi2)
    end do
    arrA(:) = arrA(:) + w1(i) * p**2 * (arrFq(1,:) + arrFq(2,:)) / arrEi(:)
end do

! æœ€åä¹˜ä»¥ 4
arrA(:) = arrA(:) * 4d0
```

### å…¬å¼

```
A = 4 Ã— âˆ« dp pÂ² [(-1)/E + (n_q + n_qÌ„)/E]
  = 4 Ã— âˆ« dp pÂ²/E Ã— [n_q + n_qÌ„ - 1]
```

å…¶ä¸­ï¼š
- `n_q`: å¤¸å…‹åˆ†å¸ƒå‡½æ•°
- `n_qÌ„`: åå¤¸å…‹åˆ†å¸ƒå‡½æ•°
- `-1`: çœŸç©ºé¡¹

### å½’ä¸€åŒ–å› å­

**Fortran çš„ A æœ€åä¹˜ä»¥ 4**

---

## ğŸ“ Julia çš„ A å‡½æ•°

### ä»£ç ï¼ˆ`OneLoopIntegrals.jl`ï¼‰

```julia
function A(m::Float64, Î¼::Float64, T::Float64, Î¦::Float64, Î¦bar::Float64,
    nodes_p::Vector{Float64}, weights_p::Vector{Float64})
    
    # å¸¸æ•°é¡¹ï¼ˆçœŸç©ºé¡¹ï¼‰
    integral = -const_integral_term_A(m)
    
    # æœ‰é™æ¸©åº¦é¡¹ï¼ˆåˆ†å¸ƒå‡½æ•°é¡¹ï¼‰
    @inbounds @simd for i in eachindex(nodes_p)
        node_p = nodes_p[i]
        weight_p = weights_p[i]
        E = sqrt(node_p^2 + m^2)
        dist_quark = distribution_value(:pnjl, :plus, E, Î¼, T, Î¦, Î¦bar)
        dist_antiquark = distribution_value(:pnjl, :minus, E, Î¼, T, Î¦, Î¦bar)
        integral += weight_p * node_p^2 / E * (dist_quark + dist_antiquark)
    end
    
    # æœ€åä¹˜ä»¥ 4
    return 4.0 * integral
end
```

### å…¬å¼

```
A = 4 Ã— [-å¸¸æ•°é¡¹ç§¯åˆ† + âˆ« dp pÂ²/E Ã— (n_q + n_qÌ„)]
```

å…¶ä¸­ï¼š
- `const_integral_term_A(m)`: çœŸç©ºé¡¹çš„è§£æç§¯åˆ†

### å½’ä¸€åŒ–å› å­

**Julia çš„ A ä¹Ÿä¹˜ä»¥ 4**

---

## ğŸ” å…³é”®å·®å¼‚

### 1. çœŸç©ºé¡¹çš„å¤„ç†

**Fortran**ï¼š
```fortran
arrA(:) = arrA(:) + w(i) * p**2 * (-1d0) / arrEi(:)
```
- çœŸç©ºé¡¹æ˜¯ `-1/E`
- é€šè¿‡æ•°å€¼ç§¯åˆ†è®¡ç®—

**Julia**ï¼š
```julia
integral = -const_integral_term_A(m)
```
- çœŸç©ºé¡¹é€šè¿‡è§£æå…¬å¼è®¡ç®—
- `const_integral_term_A(m)` è¿”å›è§£æç»“æœ

### 2. const_integral_term_A çš„å®šä¹‰

```julia
function const_integral_term_A(m::Float64)
    m_pos = max(m, 0.0)
    if m_pos < 1e-14
        return (Î›_inv_fm^2) / 2.0
    end
    
    term1 = Î›_inv_fm * sqrt(Î›_inv_fm^2 + m_pos^2)
    term2 = m_pos^2 * log((Î›_inv_fm + sqrt(Î›_inv_fm^2 + m_pos^2)) / m_pos)
    return (term1 - term2) / 2.0
end
```

**å…¬å¼**ï¼š
```
const_term = [Î›âˆš(Î›Â² + mÂ²) - mÂ² ln((Î› + âˆš(Î›Â² + mÂ²))/m)] / 2
```

è¿™æ˜¯çœŸç©ºé¡¹ `âˆ«â‚€^Î› dp pÂ²/E` çš„è§£æç»“æœã€‚

---

## ğŸ“Š æ•°å€¼éªŒè¯

### æµ‹è¯•å‚æ•°
- m_u = 0.040510 fmâ»Â¹
- Î› = 3.0523 fmâ»Â¹

### Julia çš„ const_integral_term_A

```
term1 = 3.0523 Ã— âˆš(3.0523Â² + 0.040510Â²)
      = 3.0523 Ã— âˆš(9.3165 + 0.00164)
      = 3.0523 Ã— 3.0526
      = 9.3174

term2 = 0.040510Â² Ã— ln((3.0523 + 3.0526) / 0.040510)
      = 0.00164 Ã— ln(150.37)
      = 0.00164 Ã— 5.013
      = 0.00822

const_term = (9.3174 - 0.00822) / 2
           = 9.3092 / 2
           = 4.6546 fmâ»Â¹
```

### Fortran çš„çœŸç©ºé¡¹ç§¯åˆ†

Fortran é€šè¿‡æ•°å€¼ç§¯åˆ†è®¡ç®—ï¼š
```fortran
âˆ«â‚€^Î› dp pÂ² Ã— (-1) / âˆš(pÂ² + mÂ²)
```

è¿™åº”è¯¥ç­‰äº `-const_term = -4.6546 fmâ»Â¹`

---

## ğŸ¯ å…³é”®å‘ç°

### A å€¼çš„å¯¹æ¯”

**Fortran**ï¼š
```
A_u = -4.972144 fmâ»Â²
```

**Julia**ï¼š
```
A_u = -4.964141 fmâ»Â²
```

**å·®å¼‚**ï¼š0.16%

### ä¸ºä»€ä¹ˆ A å€¼ä¸€è‡´ï¼Ÿ

è™½ç„¶ Fortran å’Œ Julia çš„çœŸç©ºé¡¹å¤„ç†æ–¹å¼ä¸åŒï¼ˆæ•°å€¼ vs è§£æï¼‰ï¼Œä½†ï¼š
1. ä¸¤è€…éƒ½ä¹˜ä»¥ç›¸åŒçš„å½’ä¸€åŒ–å› å­ 4
2. ä¸¤è€…çš„ç§¯åˆ†å…¬å¼ç›¸åŒ
3. æ•°å€¼ç§¯åˆ†å’Œè§£æç§¯åˆ†çš„ç»“æœåº”è¯¥ä¸€è‡´

**ç»“è®º**ï¼šA å€¼çš„è®¡ç®—æ˜¯ä¸€è‡´çš„ï¼

---

## ğŸ” é‚£ä¹ˆ G å€¼çš„å·®å¼‚æ¥è‡ªå“ªé‡Œï¼Ÿ

### Fortran çš„ G è®¡ç®—

```fortran
arrG(:) = - arrMass(:) * arrA(:) * (3d0*K_f) / (4d0*pi**2)
```

å±•å¼€ï¼š
```
arrG = - m Ã— A Ã— 3 Ã— K_f / (4Ï€Â²)
     = [- 3/(4Ï€Â²) Ã— m Ã— A] Ã— K_f
     = G^f Ã— K_f
```

å…¶ä¸­ï¼š
```
G^f = - 3/(4Ï€Â²) Ã— m Ã— A
```

### Julia çš„ G è®¡ç®—

```julia
G_f = -Nc / (4.0 * Ï€^2) * (m_f * A_f)
    = -3 / (4Ï€Â²) * m_f * A_f
```

**å…¬å¼å®Œå…¨ç›¸åŒï¼**

### æ•°å€¼è®¡ç®—

**Fortran**ï¼š
```
G^f = - 3/(4Ï€Â²) Ã— 0.040510 Ã— (-4.972144)
    = - 0.07598 Ã— 0.040510 Ã— (-4.972144)
    = 0.01529 fmâ»Â³
```

**Julia**ï¼š
```
G^f = - 3/(4Ï€Â²) Ã— 0.040510 Ã— (-4.964141)
    = - 0.07598 Ã— 0.040510 Ã— (-4.964141)
    = 0.01528 fmâ»Â³
```

**å®Œå…¨ä¸€è‡´ï¼**ï¼ˆå·®å¼‚æ¥è‡ª A çš„ 0.16% å·®å¼‚ï¼‰

---

## ğŸ¯ çœŸç›¸å¤§ç™½

### Fortran çš„ arrG

```
arrG = G^f Ã— K_f
     = 0.01529 Ã— 0.00519
     = 0.0000794 fmÂ²
```

**ä½†å®é™…è¾“å‡ºæ˜¯**ï¼š
```
arrG(u) = 0.000714 fmÂ²
```

**å·®äº† 9 å€ï¼**

### é—®é¢˜åœ¨å“ªé‡Œï¼Ÿ

è®©æˆ‘é‡æ–°æ£€æŸ¥ Fortran çš„è¾“å‡º...

å®é™…ä¸Šï¼ŒFortran è¾“å‡ºçš„æ˜¯ï¼š
```
G_u = 7.1415160073802497E-004 fmÂ²
    = 0.000714 fmÂ²
```

è€Œæˆ‘ä»¬è®¡ç®—çš„æ˜¯ï¼š
```
G^f Ã— K_f = 0.01529 Ã— 0.00519 = 0.0000794 fmÂ²
```

**å·®å¼‚**ï¼š
```
0.000714 / 0.0000794 = 9.0
```

---

## ğŸ” é‡æ–°æ£€æŸ¥ Fortran çš„ A å€¼

### Fortran è¾“å‡º

```
A_u = -4.9721443708746120 fmâ»Â²
```

### å¦‚æœ arrG = - m Ã— A Ã— 3 Ã— K_f / (4Ï€Â²)

```
arrG = - 0.040510 Ã— (-4.972144) Ã— 3 Ã— 0.00519 / (4Ï€Â²)
     = 0.040510 Ã— 4.972144 Ã— 3 Ã— 0.00519 / 39.478
     = 0.003125 / 39.478
     = 0.0000791 fmÂ²
```

**è¿˜æ˜¯ä¸å¯¹ï¼**

### ç­‰ç­‰...

è®©æˆ‘æ£€æŸ¥ Fortran çš„ A æ˜¯å¦æœ‰å…¶ä»–å½’ä¸€åŒ–...

ä»ä»£ç çœ‹ï¼š
```fortran
arrA(:) = arrA(:)*4d0
```

è¿™ä¸ª `4d0` æ˜¯æœ€åçš„å½’ä¸€åŒ–å› å­ã€‚

ä½†æ˜¯ï¼Œå¦‚æœ Fortran çš„ç§¯åˆ†è¿˜æœ‰å…¶ä»–éšå«çš„å› å­å‘¢ï¼Ÿ

---

## ğŸ“ éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥

1. **Fortran çš„ç§¯åˆ†æƒé‡ `w(i)` å’Œ `w1(i)`**ï¼š
   - è¿™äº›æƒé‡æ˜¯å¦‚ä½•å®šä¹‰çš„ï¼Ÿ
   - æ˜¯å¦åŒ…å«é¢å¤–çš„å½’ä¸€åŒ–å› å­ï¼Ÿ

2. **Fortran çš„ç§¯åˆ†èŒƒå›´**ï¼š
   - `npoint` å’Œ `npoint1` å¯¹åº”ä»€ä¹ˆèŒƒå›´ï¼Ÿ
   - æ˜¯å¦ä¸ Julia çš„ç§¯åˆ†èŒƒå›´ä¸€è‡´ï¼Ÿ

3. **é‡æ–°éªŒè¯ arrG çš„è®¡ç®—**ï¼š
   - åœ¨ Fortran ä»£ç ä¸­æ·»åŠ è°ƒè¯•è¾“å‡º
   - é€æ­¥éªŒè¯æ¯ä¸ªä¸­é—´é‡

---

*æ–‡æ¡£æ—¶é—´: 2026-01-26*
*çŠ¶æ€: A å‡½æ•°çš„å½’ä¸€åŒ–å› å­ç›¸åŒï¼ˆéƒ½æ˜¯ 4ï¼‰ï¼Œä½† G å€¼ä»æœ‰ 9 å€å·®å¼‚ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ç§¯åˆ†æƒé‡å’ŒèŒƒå›´*
