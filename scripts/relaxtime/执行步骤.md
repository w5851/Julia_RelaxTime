# 执行步骤：对比 Fortran 和 Julia 的弛豫时间

## 当前状态

✅ **所有基础物理量已验证一致** (差异 < 2%):
- Polyakov 环 Φ
- 有效质量 m
- 单圈积分 A
- 有效耦合 G
- 数密度 ρ

❓ **弛豫时间**: 报告相差 3 倍,需要验证

---

## 执行步骤

### 步骤 1: 重新编译 Fortran 代码

已在 `relaxtime_fortran/codes/relax time/z1 relax_time.f90` 中添加了调试输出。

**Windows (PowerShell)**:
```powershell
cd d:\Desktop\fortran代码\输运系数\relaxtime_fortran
.\compile_gfortran.ps1
```

**Linux/Mac**:
```bash
cd relaxtime_fortran
./compile_gfortran.sh
```

### 步骤 2: 运行 Fortran 代码

**Windows**:
```powershell
cd d:\Desktop\fortran代码\输运系数\relaxtime_fortran
.\build\relaxtime.exe > results\debug_relaxtime.txt 2>&1
```

**Linux/Mac**:
```bash
cd relaxtime_fortran
./build/relaxtime > results/debug_relaxtime.txt 2>&1
```

### 步骤 3: 查看 Fortran 输出

```powershell
type d:\Desktop\fortran代码\输运系数\relaxtime_fortran\results\debug_relaxtime.txt
```

或使用文本编辑器打开 `results\debug_relaxtime.txt`

### 步骤 4: 运行 Julia 对比脚本

```powershell
cd d:\Desktop\Julia_RelaxTime
julia scripts\relaxtime\extract_and_compare_relaxation_times.jl
```

---

## 预期输出

### Fortran 输出格式

```
========================================================================
DEBUG: Relaxation times at T= 29.595 MeV, mu_B= 78.920 MeV
------------------------------------------------------------------------
Densities (fm^-3):
  n_u  = 1.681
  n_ub = 1.681
  n_s  = 1.538
  n_sb = 1.538
------------------------------------------------------------------------
Relaxation times (fm):
  tau_u  = 0.01234
  tau_s  = 0.00345
  tau_ub = 0.01234
  tau_sb = 0.00345
------------------------------------------------------------------------
Scattering rates Gamma = 1/tau (fm^-1):
  Gamma_u  = 81.0
  Gamma_s  = 289.3
  Gamma_ub = 81.0
  Gamma_sb = 289.3
------------------------------------------------------------------------
Average scattering rates w_ij (fm^-1):
  w(1)  ud->ud       = 0.01234
  w(2)  uu->uu       = 0.02345
  ...
========================================================================
```

### Julia 输出格式

```
================================================================================
Fortran vs Julia 弛豫时间对比
================================================================================

温度和化学势:
  T = 0.15 fm⁻¹ (29.595 MeV)
  μ_B = 0.4 fm⁻¹ (78.92 MeV)
  μ_u = 0.13333 fm⁻¹
  μ_s = 0.13333 fm⁻¹

================================================================================
第一步：提取 Fortran 的弛豫时间
================================================================================
...

================================================================================
第二步：使用 Julia 计算弛豫时间
================================================================================
...

Julia 计算结果:
  τ_u  = 0.01234 fm
  τ_s  = 0.00345 fm
  τ_ub = 0.01234 fm
  τ_sb = 0.00345 fm

================================================================================
第三步：对比 Fortran 和 Julia 的结果
================================================================================

弛豫时间对比:
  夸克        Fortran         Julia           差异
  ----        -------         -----           ----
  u           1.234e-02       1.234e-02       0.00%
  s           3.450e-03       3.450e-03       0.00%
  ubar        1.234e-02       1.234e-02       0.00%
  sbar        3.450e-03       3.450e-03       0.00%
```

---

## 下一步

### 如果弛豫时间一致 (差异 < 10%)

✅ **问题解决!** 之前的 3 倍差异可能是:
- 使用了不同的参数
- 单位换算错误
- 数据提取错误

### 如果弛豫时间仍有显著差异 (> 50%)

需要逐步检查计算链:

1. **平均散射率 w_ij**
   - 对比每个散射过程的 w_ij
   - 找出哪些过程有差异

2. **总截面 σ(s)**
   - 对比相同 s 值下的 σ(s)
   - 检查积分范围和方法

3. **散射振幅 M²**
   - 对比相同动量下的 M²
   - 检查有效耦合系数的使用

---

## 相关文档

- `NEXT_STEPS_RELAXTIME_COMPARISON.md`: 详细的对比计划
- `FORTRAN_DEBUG_INSTRUCTIONS.md`: Fortran 调试指南
- `COMPLETE_RESOLUTION.md`: 完整解决方案总结

---

*日期: 2026-01-26*
*状态: 准备运行对比*
